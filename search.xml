<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>firsttime</title>
    <url>/2016/08/17/firsttime/</url>
    <content><![CDATA[<p>å°è¯•ä¸‹hexoæ­åšå®¢,æ„Ÿè§‰è¿˜æ˜¯githubä¸‹ç”¨issueæ›´å¿«ä¸€ç‚¹å„¿?å˜›,ç”¨hexoå€’æ˜¯å¯ä»¥æœ‰å¥½çœ‹çš„ä¸»é¢˜æ¥ç”¨</p>
<p>åšå®¢åšæŒå†™ä¸‹å»çš„å¯èƒ½æ€§å¯¹æˆ‘æ¥è¯´è¿˜æœªçŸ¥= =</p>
<p>æœ‰æœºä¼šå†ä½“éªŒä¸‹hexoå§</p>
<p><a href="https://github.com/5Mi/wumi_blog">githubä¸‹ç”¨issueæ²¡äº‹å„¿ä¼šè®°ç‚¹å„¿ä¸œè¥¿</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo again</title>
    <url>/2021/04/25/hexoagain/</url>
    <content><![CDATA[<p>æ—¶éš”å¤šå¹´å†æ¬¡æ›´æ–°ä¸‹blog, æ›´æ–°ä¸‹ä¸»é¢˜, æƒ³ç€è®°å½•ç‚¹å„¿ä»€ä¹ˆ~</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡jenkinsç›¸å…³è¢«æŒ–çŸ¿å¤„ç†çš„åº”å¯¹</title>
    <url>/2021/04/27/jenkins-bug/</url>
    <content><![CDATA[<h3 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h3><p>äº‹ä»¶çš„èµ·æºå…¶å®æ˜¯ä¸Šæ¬¡æ›´æ–°blogåçš„ç–‘é—®</p>
<blockquote>
<p>æ—¶éš”å¤šå¹´å†æ¬¡æ›´æ–°ä¸‹blog, æ›´æ–°ä¸‹ä¸»é¢˜, æƒ³ç€è®°å½•ç‚¹å„¿ä»€ä¹ˆ~</p>
</blockquote>
<p>è™½è¯´æƒ³æ³•æ˜¯å¥½çš„, ä½†ä½œä¸ºä¸€ä¸ªèµ„æ·±<code>æ²‰é»˜çš„è§‚å¯Ÿå‘˜</code>çš„æˆ‘, è‡ªç„¶æ˜¯ <code>å½“æˆ‘æ²‰é»˜ç€çš„æ—¶å€™,æˆ‘è§‰å¾—å……å®,æˆ‘å°†å¼€å£,åŒæ—¶æ„Ÿåˆ°ç©ºè™š</code>, æ‰€ä»¥å¹³æ—¶çœ‹çœ‹è¿˜å¥½, çœŸè¦å¼ å˜´é©¬ä¸Šæ— è¯å¯è¯´äº†, å¹³æ—¶æ²¡äº‹å„¿å°±æ€è€ƒäººç”Ÿ,æƒ³èµ·è‡ªå·±æ¯•ä¸šæ—¶å†™çš„ä¸€ä¸ªé™æ€é¡µé¢, é‚£æ˜¯ä¸€ä¸ªä»‹ç»æˆ‘å½“æ—¶ç©çš„æ¸¸æˆçš„å°é¡µé¢, æƒ³ç€æ­£å¥½æœåŠ¡å™¨,åŸŸåéƒ½ç©ºç€æ²¡ç”¨, ä¸å¦¨æŠŠè¿™ä¸ªå½“æ—¶ç…§ç€è§†é¢‘æ•™ç¨‹å¼€å‘çš„å°é¡µé¢æ”¾ä¸Šå»è¯•è¯•, ä¹Ÿç®—çºªå¿µä¸‹å›å½’åˆå¿ƒ</p>
<p>è¯´å¹²å°±å¹², æœ¬åœ°sshç™»å½•æœåŠ¡å™¨æ—¶å´ç™»ä¸ä¸Š, ä¹‹å‰å¯èƒ½å¡äº†ç‚¹è¿˜æ€»æ–­,ä½†å¥½æ­¹æ˜¯èƒ½ç™»ä¸Šçš„, è¿™å›<code>ssh -i</code>æŒ‡å®šå¯†é’¥çš„æƒ…å†µä¸‹å´ä»æç¤ºè¾“å…¥å¯†ç , å“ªæ€•å¯†ç æ­£ç¡®(ç‰¹æ„é‡ç½®äº†ğŸ˜­)ä¹Ÿä¸æ–­æç¤ºé‡æ–°è¾“å…¥å¯†ç ç›´åˆ°<code>Permission denied</code>, æ˜æ˜æŒ‡å®šå¯†é’¥ä¸éœ€è¦å†è¾“å¯†ç æ¥ç€, çœ‹æ¥æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜, åˆ°æ§åˆ¶å°ç½‘é¡µç™»å½•,å‘ç°å¯†é’¥/å¯†ç éƒ½æ˜¯okçš„, åªå¥½ç¿»ç¿»<a href="https://cloud.tencent.com/document/product/213/35574#ssh-.E9.97.AE.E9.A2.98.E5.AF.BC.E8.87.B4.E6.97.A0.E6.B3.95.E7.99.BB.E5.BD.95">æ–‡æ¡£</a>æ‰¾è§£å†³æ–¹æ¡ˆ</p>
<h3 id="åº”å¯¹"><a href="#åº”å¯¹" class="headerlink" title="åº”å¯¹"></a>åº”å¯¹</h3><p>ä¸€æ¡æ¡å¯¹ä¸‹æ¥å‘ç°æœ‰æ¡å¯¹åº”<strong>æœåŠ¡å™¨é«˜è´Ÿè½½</strong>ç›¸å…³çš„, åˆ°å®ä¾‹ç›‘æ§ä¸Šçœ‹, å¥½å˜›, cpuæœç„¶å·²ç»é£™åˆ°æé™äº†</p>
<p><img src="tencentdoc.png" alt="tencentdoc"><br><img src="cloudserve.png" alt="cloudserve"></p>
<ul>
<li><p>åœ¨ä¸€é€šæœç´¢ä¸‹å¾—çŸ¥, é€šè¿‡<code>top</code>å‘½ä»¤æŸ¥çœ‹å½“å‰cpuè¿è¡Œç›¸å…³çŠ¶æ€</p>
<p><img src="termial_1.png" alt="termial_1.png"></p>
</li>
<li><p>é€šè¿‡è¾“å…¥k æŒ‡å®špid,æˆ‘ä»¬å¯ä»¥ç›´æ¥killæ‰å ç”¨cpuè¿‡é«˜çš„traceè¿›ç¨‹, ä½†å¤šæ¬¡æ€è¿›ç¨‹è¿™ä¸ªtraceå´æ€»ä¼šé‡å¯, æ¥ç€æˆ‘ä»¬é€šè¿‡<code>PID</code>æ¥æ‰¾åˆ°å¯¹åº”è¿›ç¨‹å’Œæ‰€åœ¨ç›®å½•, pidçš„æŸ¥çœ‹é™¤<code>top</code>å¤–ä¹Ÿå¯ä½¿ç”¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ps -ef |grep [Pname è¿›ç¨‹å]</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šå›¾çš„æœ€åè¿è¡Œ<code>ps -ef |grep trace</code>çš„è¿”å›å¯è§åˆ°ä¸€äº›å…³é”®ä¿¡æ¯, åƒä»€ä¹ˆ<code>mine.c3pool.com</code>ä¸€çœ‹å°±æ˜¯è€çŸ¿å·¥äº†, <code>2020jenkins</code>å¯èƒ½å°±æ˜¯å›å˜é©å‘½çš„å…ƒå‡¶</p>
</li>
<li><p>é€šè¿‡<code>PID</code>æ¥æ‰¾åˆ°å¯¹åº”è¿›ç¨‹å’Œæ‰€åœ¨ç›®å½•åˆ™ä½¿ç”¨, å…¶ä¸­ <strong>/procç›®å½•ä¸­åŒ…å«è®¸å¤šä»¥æ•°å­—å‘½åçš„å­ç›®å½•ï¼Œè¿™äº›æ•°å­—è¡¨ç¤ºç³»ç»Ÿå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œé‡Œé¢åŒ…å«å¯¹åº”è¿›ç¨‹ç›¸å…³çš„å¤šä¸ªä¿¡æ¯æ–‡ä»¶</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ls -l /proc/[PID]</span><br><span class="line">å½“ç„¶ç›´æ¥ <span class="built_in">cd</span> /proc/[PID] å† llä¹Ÿæ˜¯ä¸€æ ·çš„</span><br><span class="line">å†å°±æ˜¯</span><br><span class="line">pwdx [PID]</span><br></pre></td></tr></table></figure>
<p>å½“æ—¶å¿˜äº†æˆªå›¾, åº”è¯¥å’Œä»¥ä¸‹ç›¸ä¼¼, å½“æ—¶çš„exeå’Œpwdéƒ½æŒ‡å‘ <code>/var/jenkins_home/XXX../trace</code>ä½†æˆ‘æœåŠ¡å™¨æœ¬åœ°æ˜¯æ²¡æœ‰è¿™ä¸ªç›®å½•çš„<br><img src="terminal_3.png" alt="terminal"><br>è€ƒè™‘åˆ°æˆ‘çš„jenkinsæ˜¯dockerèµ·çš„, é©¬ä¸Šæ‰¾åˆ°å¯¹åº”çš„æŒ‚è½½ç›®å½•, ä»<code>jenkins_home</code>ä¸€è·¯æ‰¾åˆ°è¿™ä¸ª<code>trace</code>, ä½†å‘ç°å°±ç®—å°†traceåˆ é™¤å®ƒä¹Ÿé©¬ä¸Šä¼šå†è‡ªåŠ¨ç”ŸæˆğŸ˜±,æ¥ä¸‹æ¥é€šè¿‡<strong>jenkins</strong>ä½œä¸ºå…³é”®å­—é€šè¿‡ç½‘ç»œæœç´¢æœç„¶èƒ½å‘ç°äº›ç«¯å€ª, å‚è€ƒ<a href="https://www.jianshu.com/p/70e071113044?from=groupmessage&isappinstalled=0">è¿™ç¯‡</a>å’Œ<a href="https://blog.csdn.net/g6U8W7p06dCO99fQ3/article/details/90205674">è¿™ç¯‡</a>åŸºæœ¬ä¸Šèƒ½ç¡®å®šæˆ‘ç¢°ä¸Šçš„ä¹Ÿæ˜¯è¿™ç§æƒ…å†µäº†,ç™»ä¸Šjenkinsä¸€çœ‹æœç„¶å†ä¸€ç›´é‡å¤è·‘ç€å‡ ä¸ªä¸æ˜¯æˆ‘å»ºçš„build<br><img src="jenkins_dashbord.png" alt="jenkins_dashbord"></p>
</li>
</ul>
<p>ä¹‹åå¤„ç†åˆ™æ˜¯æŒ‰ç…§ä»¥ä¸‹é¡ºåº:</p>
<ul>
<li>ç¦ç”¨Jenkins task</li>
<li>å‡çº§Jenkinsç‰ˆæœ¬</li>
<li>æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬</li>
</ul>
<h3 id="å‡çº§Jenkinsç‰ˆæœ¬"><a href="#å‡çº§Jenkinsç‰ˆæœ¬" class="headerlink" title="å‡çº§Jenkinsç‰ˆæœ¬"></a>å‡çº§Jenkinsç‰ˆæœ¬</h3><p>ç¦ç”¨Jenkins taskä¸å¿…å¤šè¨€ç›´æ¥åœ¨é¡µé¢ä¸Šè®¾ç½®ç¦ç”¨å³å¯, ä¸»è¦æ˜¯å‡çº§Jenkinsç‰ˆæœ¬, é¡µé¢ä¸Šä¹Ÿæœ‰æç¤ºå‡çº§,ç‚¹å‡»å´ä¸€ç›´å‡çº§å¤±è´¥(å¯èƒ½æ˜¯ç½‘ç»œç­‰åŸå› ,å…³é”®æ–‡ä»¶ä¸‹è½½å¤±è´¥ä¹‹ç±»çš„,è¿™ä¸æ˜¯å¾ˆå¸¸è§å—), é‰´äºæˆ‘çš„jenkinsæ˜¯dockerè·‘çš„, å‚è€ƒç½‘ä¸Šçš„ä¸€äº›æ–‡ç« ,é€šè¿‡æ›´æ–°å®¹å™¨ä¸­çš„waråŒ…æ¥å‡çº§jenkins:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥jenkinså®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [jenkins contanerID] sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½æ–°åŒ…</span></span><br><span class="line"><span class="built_in">cd</span> /var/jenkins</span><br><span class="line">wget http://mirrors.jenkins.io/war/latest/jenkins.war</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥waråŒ…çš„å­˜æ”¾è·¯å¾„ï¼Œå¤‡ä»½æ—§åŒ…ï¼Œæ–°åŒ…ä»£æ›¿</span></span><br><span class="line">somehost$:/<span class="comment"># cd /usr/share/jenkins/</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># ls</span></span><br><span class="line">jenkins.war</span><br><span class="line"> </span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># mv jenkins.war jenkins.war-bak</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># cp /var/jenkins_home/jenkins.war .</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># ls</span></span><br><span class="line">jenkins.war  jenkins.war-bak</span><br><span class="line"> </span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># exit </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯å®¹å™¨</span></span><br><span class="line">docker restart [jenkins contanerID]</span><br></pre></td></tr></table></figure>
<p>ä¹‹åé‡æ–°è®¿é—®jenkinsé¡µé¢å°±ä¼šå‘ç°jenkinsåœ¨å‡†å¤‡å‡çº§,ç¨åå°±ä¼šå®Œæˆå‡çº§, å‡çº§åçš„jenkinsåˆ™ä¼šæç¤º<a href="https://wiki.jenkins.io/display/JENKINS/Security+implication+of+building+on+master">å·²æœ‰é£é™©</a><br><img src="jenkins_doc_security.png" alt="jenkins_doc_security"><br>çœ‹èµ·æ¥å¥½åƒè¯´çš„æ˜¯é€šè¿‡jenkins controllerç›´æ¥è¿è¡Œçš„buildèƒ½ç›´æ¥è¯»å†™<code>$JENKINS_HOME</code>çš„æ–‡ä»¶,ç›¸å½“äºèƒ½è§¦åŠåƒå®‰è£…æ’ä»¶,è¯»å‡­è¯,åˆ›å»ºæ–°jobç­‰å‡ ä¹æ‰€æœ‰æ“ä½œäº†, æ‰€ä»¥è²Œä¼¼æ˜¯å»ºè®®é€šè¿‡å…¶ä»–æœåŠ¡å™¨,æ¥ä»£ç†è·‘æ„å»ºä»»åŠ¡(<code>agent</code>), å¦åˆ™çš„è¯å°±è¦å¥½å¥½æ£€æŸ¥ä¸‹<code>$JENKINS_HOME</code>çš„æƒé™äº†, jenkinsæˆ‘æš‚æ—¶ç”¨ä¸ä¸Š,å…ˆæŒ‰ä¸Šé¢è®¾ç½®æŠŠæ‰§è¡Œå™¨æ”¹æˆé›¶<br><img src="jenkins_node.png" alt="jenkins_node"></p>
<h3 id="æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬"><a href="#æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬" class="headerlink" title="æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬"></a>æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬</h3><p>æ¥ä¸‹æ¥å†æ£€æŸ¥ä¸‹æœåŠ¡å™¨åœ¨è·‘å•¥å®šæ—¶è„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">crontab -l <span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">crontab -r <span class="comment"># æ¸…ç©º</span></span><br></pre></td></tr></table></figure>
<p><img src="terminal_4.png" alt="terminal_4"></p>
<p>ç¡®å®å‘ç°äº†ä¸ªæˆ‘æ¯«æ— å°è±¡çš„è„šæœ¬, ä¹Ÿæ²¡å¤šæƒ³,ç›´æ¥è¢«æˆ‘<code>crontab -r</code>äº†, ä¸€å¥—æ“ä½œä¸‹æ¥<code>top</code>å‘½ä»¤æŸ¥çœ‹å, cpuä½¿ç”¨å·²ç„¶æ¢å¤æ­£å¸¸(æœåŠ¡å™¨æ›´æœ¬æ²¡è·‘å•¥,å ç”¨ç‡è¶‹è¿‘äº0äº†), ç½ªé­ç¥¸é¦–traceä¹Ÿä¸å†å¤æ´», ä¹Ÿç®—æ˜¯ã€Œä¸€ä»¶è½ç€/ã„ã£ã‘ã‚“ã‚‰ãã¡ã‚ƒãã€</p>
<h3 id="ç»ˆå±€"><a href="#ç»ˆå±€" class="headerlink" title="ç»ˆå±€"></a>ç»ˆå±€</h3><p>è§£å†³åå›åˆ°æœ¬åœ°sshç™»å½•æœåŠ¡å™¨,å‘ç°ä»æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">root@xxx.xx.xx.xxx<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">root@xxx.xx.xx.xxx&#x27;</span>s password: </span><br><span class="line">root@xxx.xx.xx.xxx: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,pa</span><br><span class="line">ssword)</span><br></pre></td></tr></table></figure>
<p>fuck sake,è¿™å°±å¤ªä»¤äººå¥‡æ€ªå•¦,å‚è€ƒç½‘ä¸Šä¿®æ”¹ <code>/etc/ssh/ssh_config</code> å¼€å¯å¯†ç éªŒè¯, rootç”¨æˆ·ç™»å½•ç­‰é€‰é¡¹é‡å¯sshæœåŠ¡å•¥çš„éƒ½è¯•äº†ä¸€é, è¿˜æ˜¯ä¸ç®¡ç”¨, æœ€åçš„æœ€åå‘ç°ä»æœ€å¼€å§‹æœ¬åœ°ç™»å½•æ—¶çš„å…¬ç½‘ipå°±æ‰“é”™äº†ä¸€ä½, çœŸçš„æ˜¯çŸ¥é“ç»“å±€çš„æˆ‘çœ¼æ³ªè½ä¸‹æ¥, æ®‹å¿µ</p>
<h3 id="æ”¶å°¾"><a href="#æ”¶å°¾" class="headerlink" title="æ”¶å°¾"></a>æ”¶å°¾</h3><p>ç™»å½•ä¸ŠæœåŠ¡å™¨å°±å¥½è¯´äº†, æŠŠä¹‹å‰çš„é™æ€æ–‡ä»¶ä¸Šä¼ ä¸Šå»å°±å¥½, çœ‹ç€è‡ªå·±æœ€æœ€å¼€å§‹å†™çš„é¡µé¢çœŸæ˜¯æ„Ÿæ…¨ä¸‡åƒ, ä»¿ä½›å½“æ—¶çš„æƒ…æ„Ÿåˆæ¶Œä¸Šå¿ƒå¤´, å¯ç°åœ¨çš„è‡ªå·±åˆæœ‰å¤šå°‘æˆé•¿å‘¢, æ˜¯å¦åˆå¤±å»äº†å¤§æŠŠå¯èƒ½æ€§, å˜å¾—è¶Šæ¥è¶Šæ— è¶£äº†å‘¢. </p>
<p>ps. æœåŠ¡å™¨åŸŸåä¼°è®¡ä»Šå¹´ä¸­æ—¬å°±åˆ°æœŸäº†,å§‘ä¸”å…ˆæ”¾ç€å‡ å¤©å§, <a href="https://www.mimimimimi.top/">www.mimimimimi.top</a>, è¿™æ¸¸æˆæ˜¯æˆ‘å¤§å­¦è¦æ¯•ä¸šæ—¶ç©å„¿çš„, å½“æ—¶è®°å¾—é€šå…³ä¸€å‘¨ç›®æ™®é€šæ¨¡å¼æ­»äº†300å¤šæ¬¡, åƒç´ æ¸¸æˆå°è€Œç²¾ç¾,å¾ˆæœ‰æ—ºè¾¾ä¸å·¨åƒçš„å‘³é“, é‚£å‡ å¤©ä¸‹æ¥è„‘è¢‹é‡Œéƒ½æ˜¯è¿™æ¬¾æ¸¸æˆ, å“ˆå“ˆ, æ¯•è®¾è¦å†™å•¥,èˆå‹ä»¬éƒ½åœ¨å‘æ„, æˆ‘æƒ³ç€è¦ä¸ç„¶å°±å†™ä¸ªä»‹ç»è¿™ä¸ªæ¸¸æˆçš„â€å°ç½‘ç«™â€å§, è¿™ä¹ˆå¤šå¹´åå®ƒç»ˆäºè¢«æˆ‘å†æ¬¡æƒ³èµ·,æˆåŠŸä¸Šçº¿äº†ğŸ˜ </p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>ssh</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨fabricå®Œæˆå¤šè¾¹å½¢é€‰åŒº</title>
    <url>/2021/05/06/%E4%BD%BF%E7%94%A8fabric%E5%AE%8C%E6%88%90%E5%A4%9A%E8%BE%B9%E5%BD%A2%E9%80%89%E5%8C%BA/</url>
    <content><![CDATA[<p><img src="draw.gif" alt="a"></p>
<p>ä¹‹å‰æœ‰è¿‡è¿™ä¹ˆä¸ªéœ€æ±‚, è¯´æ˜¯è¦åœ¨å›¾ç‰‡ä¸­é€‰åŒº(è½¦ç«™,å¹¿åœºç­‰),ç„¶åé€‰åŒºçš„è¦æ±‚æ˜¯<strong>ä¸è§„åˆ™å‡¸å¤šè¾¹å½¢</strong> <strong>æŒ‰ç‚¹è¿æ¥</strong>, ä¹‹åè¦è·å–é€‰åŒºç‚¹åæ ‡, åŒæ—¶ä¹Ÿæœ‰å°†ç”Ÿæˆç‚¹åæ ‡å›æ˜¾å±•ç¤ºé€‰åŒºçš„éœ€æ±‚, åœ¨ä¸€ç•ªè°ƒç ”ä¹‹åå†³å®šä½¿ç”¨<a href="http://fabricjs.com/">fabric.js</a>æ¥å®ç°åŠŸèƒ½</p>
<blockquote>
<p>Fabricæ˜¯ä¸€ä¸ªå¼ºå¤§è€Œç®€å•çš„JS Canvasåº“ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ä½¿ç”¨å®ƒå®ç°åœ¨Canvasä¸Šåˆ›å»ºã€å¡«å……å›¾å½¢ã€ç»™å›¾å½¢å¡«å……æ¸å˜é¢œè‰²ã€‚ ç»„åˆå›¾å½¢ï¼ˆåŒ…æ‹¬ç»„åˆå›¾å½¢ã€å›¾å½¢æ–‡å­—ã€å›¾ç‰‡ç­‰ï¼‰ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨Fabricä»è€Œä»¥è¾ƒä¸ºç®€å•çš„æ–¹å¼å®ç°è¾ƒä¸ºå¤æ‚çš„CanvasåŠŸèƒ½</p>
</blockquote>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æ•´ä¸ªçš„æ€è·¯å¤§æ¦‚æ˜¯å…ˆåˆå§‹åŒ–fabricå®ä¾‹,å°†å›¾ç‰‡å±•ç¤ºåˆ°canvasä¸Š,æ ¹æ®å›¾ç‰‡å’Œcanvasçš„å°ºå¯¸å¾—åˆ°ç¼©æ”¾æ¯”ä¾‹,æ–¹ä¾¿å°†åç»­å¾—åˆ°çš„ç‚¹åæ ‡æŒ‰å›¾ç‰‡å°ºå¯¸è¿˜åŸ.æ¥ç€é€šè¿‡é¼ æ ‡ç‚¹å‡»åœ¨canvasä¸Šç»˜åˆ¶ç‚¹,å°†ç‚¹æŒ‰ç…§ç‚¹å‡»é¡ºåºè¿æ¥æˆçº¿,åˆ™å¾—åˆ°å¤šè¾¹å½¢çš„è¾¹,æ­¤æ—¶ä¸‰ä¸ªç‚¹ä»¥ä¸Šåˆ™å¯è¿æ¥æˆå¤šè¾¹å½¢,å½“ç‚¹å‡»å®Œæˆæ—¶å°†<strong>èµ·å§‹ç‚¹</strong>ä¸<strong>ç»ˆç‚¹</strong>è¿æ¥é—­åˆæˆå¤šè¾¹å½¢.</p>
<p><img src="draw-close.png" alt="draw-close"></p>
<p>å…¶ä¸­æ ¸å¿ƒçš„é—®é¢˜åˆ™æ˜¯æŒ‰é¡ºåºè¿æ¥çš„ç‚¹,å½“å›¾å½¢å®Œæˆ,èµ·å§‹ç‚¹å’Œç»ˆç‚¹è¿æ¥æ—¶,é€‰åŒºå›¾å½¢æ˜¯å¦èƒ½æˆä¸ºä¸€ä¸ªå¤šè¾¹å½¢?æ­¤å¤„æˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯, é€šè¿‡é¼ æ ‡ç§»åŠ¨,å¯ä»¥è½ç‚¹æ—¶é¼ æ ‡åŒé¦–å°¾ç‚¹è¿æ¥è™šçº¿,å½“æ— æ³•ç»˜åˆ¶æ‰€éœ€å¤šè¾¹å½¢æ—¶éšè—è™šçº¿å¹¶<strong>æ— æ³•è½ç‚¹</strong>,ç¡®ä¿å·²ç»ç»˜åˆ¶çš„ç‚¹ä¹‹é—´å¯è¿æˆå¤šè¾¹å½¢</p>
<p><img src="draw-cross.png" alt="draw-cross"></p>
<p>å³æ ¸å¿ƒçš„åˆ¤æ–­åˆ™æ˜¯:</p>
<ul>
<li>èµ·å§‹ç‚¹ä¸é¼ æ ‡è¿çº¿:line1,ç»ˆç‚¹ä¸é¼ æ ‡è¿çº¿:line2,åˆ™line1,line2æ˜¯å¦<strong>åŒæ—¶</strong>ä¸å·²è¿æ¥çš„çº¿æ®µ<strong>ç›¸äº¤</strong>, åŒæ—¶ç›¸äº¤åˆ™æ— æ³•è½ç‚¹<br><img src="draw2.png" alt="draw2"></li>
<li><strong>å·²è¿æ¥çº¿æ®µä¸­é™¤é¦–å°¾ä¸¤æ¡å¤–</strong>, æ˜¯å¦å­˜åœ¨line1<strong>æˆ–</strong>line2ä¸æŸæ¡çº¿æ®µç›¸äº¤, ç›¸äº¤åˆ™æ— æ³•è½ç‚¹<br><img src="draw3.png" alt="draw3"></li>
<li>é€šè¿‡å‘é‡å‰ä¹˜åˆ¤æ–­çº¿æ®µç›¸äº¤<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å‘é‡å‰ä¹˜</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">crossMul</span>(<span class="params">v1, v2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v1.x * v2.y - v1.y * v2.x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­ä¸¤æ¡çº¿æ®µæ˜¯å¦ç›¸äº¤line1(p1,p2) line2(p3,p4)</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkCross</span>(<span class="params">p1, p2, p3, p4</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> v1 = &#123; <span class="attr">x</span>: p1.x - p3.x, <span class="attr">y</span>: p1.y - p3.y &#125;,</span><br><span class="line">      v2 = &#123; <span class="attr">x</span>: p2.x - p3.x, <span class="attr">y</span>: p2.y - p3.y &#125;,</span><br><span class="line">      v3 = &#123; <span class="attr">x</span>: p4.x - p3.x, <span class="attr">y</span>: p4.y - p3.y &#125;,</span><br><span class="line">      v = crossMul(v1, v3) * crossMul(v2, v3);</span><br><span class="line">    v1 = &#123; <span class="attr">x</span>: p3.x - p1.x, <span class="attr">y</span>: p3.y - p1.y &#125;;</span><br><span class="line">    v2 = &#123; <span class="attr">x</span>: p4.x - p1.x, <span class="attr">y</span>: p4.y - p1.y &#125;;</span><br><span class="line">    v3 = &#123; <span class="attr">x</span>: p2.x - p1.x, <span class="attr">y</span>: p2.y - p1.y &#125;;</span><br><span class="line">    <span class="keyword">return</span> v &lt;= <span class="number">0</span> &amp;&amp; crossMul(v1, v3) * crossMul(v2, v3) &lt;= <span class="number">0</span></span><br><span class="line">      ? <span class="literal">true</span></span><br><span class="line">      : <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>é¦–å…ˆé¡µé¢ä¸Šè¦æœ‰ä¸ªcanvaså®¹å™¨,æ®æ­¤ç”Ÿæˆfabricçš„canvaså®ä¾‹,è¿˜è¦å°†å›¾ç‰‡å±•ç¤ºåœ¨canvasä¸­,ç„¶åæ ¹æ®å›¾ç‰‡å°ºå¯¸,canvaså°ºå¯¸å¾—åˆ°å±•ç¤ºçš„ç¼©æ”¾æ¯”ä¾‹<code>radio</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> convasDefaultWidth = <span class="number">500</span>;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="keyword">var</span> image = <span class="keyword">new</span> fabric.Image(<span class="built_in">document</span>.getElementById(<span class="string">&quot;image&quot;</span>));</span><br><span class="line">      <span class="keyword">var</span> imageWidth = image.get(<span class="string">&quot;width&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> canvasWidth =</span><br><span class="line">        imageWidth &gt; convasDefaultWidth ? convasDefaultWidth : imageWidth;</span><br><span class="line">      <span class="comment">// ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> radio = imageWidth / canvasWidth;</span><br><span class="line">      <span class="comment">// fabfricå®ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> canvas = <span class="keyword">new</span> fabric.Canvas(<span class="string">&quot;canvas&quot;</span>, &#123;</span><br><span class="line">        width: canvasWidth,</span><br><span class="line">        height: image.get(<span class="string">&quot;height&quot;</span>) / radio,</span><br><span class="line">        backgroundImage: image.scaleToWidth(canvasWidth),</span><br><span class="line">        backgroundColor: <span class="string">&#x27;transparent&#x27;</span>,</span><br><span class="line">        selection:<span class="literal">false</span></span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>
<p>å½“ç»˜åˆ¶å®Œæˆæˆ–å›æ˜¾æ—¶, ç›´æ¥ä½¿ç”¨fabricç»˜åˆ¶å¤šè¾¹å½¢å³å¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> polygon = <span class="keyword">new</span> fabric.Polygon([], &#123;</span><br><span class="line">        strokeWidth: <span class="number">2</span>,</span><br><span class="line">        stroke: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">        fill: <span class="string">&quot;transparent&quot;</span>,</span><br><span class="line">        objectCaching: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// transparentCorners: false,</span></span><br><span class="line">        <span class="comment">// cornerColor: &quot;blue&quot;,</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// æ·»åŠ åˆ°ç”»å¸ƒ</span></span><br><span class="line">      canvas.add(polygon);</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–å„ä¸ªçŠ¶æ€,ä»¥åŠå°†æ¥é¼ æ ‡æ˜¾ç¤ºçš„è¿æ¥çº¿ç­‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å·²ç»˜åˆ¶ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> points = [];</span><br><span class="line"><span class="comment">// å½“å‰æ˜¯å¦å¯ä»¥è½ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> canAddPoint = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// å·²å­˜åœ¨çº¿æ®µ</span></span><br><span class="line"><span class="keyword">var</span> existLines = [];</span><br><span class="line"><span class="comment">// ç»˜åˆ¶æ˜¯å¦å®Œæˆ</span></span><br><span class="line"><span class="keyword">var</span> isCompelete = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// çº¿æ®µé»˜è®¤é…ç½®</span></span><br><span class="line"><span class="keyword">var</span> lineOption = &#123;</span><br><span class="line">  strokeWidth: <span class="number">2</span>,</span><br><span class="line">  stroke: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  fill: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  selectable: <span class="literal">false</span>,</span><br><span class="line">  evented: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è¿æ¥çº¿ä½¿ç”¨è™šçº¿</span></span><br><span class="line"><span class="keyword">var</span> dashLineOption = <span class="built_in">Object</span>.assign(&#123;&#125;,lineOption,&#123;<span class="attr">strokeDashArray</span>: [<span class="number">10</span>, <span class="number">15</span>]&#125;)</span><br><span class="line"><span class="comment">// é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line"><span class="keyword">var</span> combineLineWithFirst = <span class="keyword">new</span> fabric.Line([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], dashLineOption);</span><br><span class="line"><span class="keyword">var</span> combineLineWithSecond = <span class="keyword">new</span> fabric.Line([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], dashLineOption);</span><br><span class="line"><span class="comment">// æ·»åŠ è‡³canvas</span></span><br><span class="line">canvas.add(combineLineWithFirst);</span><br><span class="line">canvas.add(combineLineWithSecond);</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–fabric canvasçš„é¼ æ ‡äº‹ä»¶,å³é¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç§»åŠ¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canvasHandleMouseMove</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pointsLen = points.length;</span><br><span class="line">  <span class="keyword">if</span> (pointsLen === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// èµ·ç‚¹ä¸ç»ˆç‚¹</span></span><br><span class="line">  <span class="keyword">var</span> firstPoint = points[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> lastPoint = points[pointsLen - <span class="number">1</span>];</span><br><span class="line">  <span class="comment">// ä¸¤ç‚¹ä»¥ä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (pointsLen &gt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// å·²ç»˜åˆ¶çš„çº¿æ®µ</span></span><br><span class="line">    <span class="keyword">var</span> exlines = getLinesArr();</span><br><span class="line">    <span class="keyword">var</span> hasCross = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; exlines.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> perline = exlines[i];</span><br><span class="line">      <span class="keyword">var</span> point1 = &#123; <span class="attr">x</span>: perline[<span class="number">0</span>], <span class="attr">y</span>: perline[<span class="number">1</span>] &#125;;</span><br><span class="line">      <span class="keyword">var</span> point2 = &#123; <span class="attr">x</span>: perline[<span class="number">2</span>], <span class="attr">y</span>: perline[<span class="number">3</span>] &#125;;</span><br><span class="line">      <span class="comment">// æ ¹æ®ä¹‹å‰æ‰€è¯´çš„åˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">      <span class="comment">// line1,line2æ˜¯å¦åŒæ—¶ä¸å·²è¿æ¥çš„çº¿æ®µç›¸äº¤</span></span><br><span class="line">      <span class="comment">// æˆ– å­˜åœ¨line1æˆ–line2ä¸æŸæ¡çº¿æ®µç›¸äº¤</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        checkCross(options.pointer, firstPoint, point1, point2) &amp;&amp;</span><br><span class="line">        checkCross(options.pointer, lastPoint, point1, point2)</span><br><span class="line">      ) &#123;</span><br><span class="line">        hasCross = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; i &lt; exlines.length - <span class="number">1</span> &amp;&amp; (checkCross(options.pointer, firstPoint, point1, point2) ||</span><br><span class="line">      checkCross(options.pointer, lastPoint, point1, point2)))&#123;</span><br><span class="line">        hasCross = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// èƒ½è½ç‚¹, ç»˜åˆ¶é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line">  <span class="keyword">if</span> (!hasCross) &#123;</span><br><span class="line">    canAddPoint = <span class="literal">true</span>;</span><br><span class="line">    setLineWithPoint(combineLineWithFirst, options.pointer, firstPoint);</span><br><span class="line">    setLineWithPoint(combineLineWithSecond, options.pointer, lastPoint);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// éšè—é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line">    canAddPoint = <span class="literal">false</span>;</span><br><span class="line">    setLineWithPoint(combineLineWithFirst);</span><br><span class="line">    setLineWithPoint(combineLineWithSecond);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// fabric ç»˜åˆ¶</span></span><br><span class="line">  canvas.renderAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç‚¹å‡»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canvasHandleMouseDown</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!canAddPoint) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">var</span> pointsLen = points.length;</span><br><span class="line">        <span class="keyword">var</span> lastPoint = points[pointsLen - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          lastPoint &amp;&amp;</span><br><span class="line">          options.pointer.x === lastPoint.x &amp;&amp;</span><br><span class="line">          options.pointer.y === lastPoint.y</span><br><span class="line">        )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// console.log(options, options.pointer.x, options.pointer.y);</span></span><br><span class="line">        <span class="comment">// è½ç‚¹, æ³¨æ„ç²¾åº¦</span></span><br><span class="line">        points.push(&#123;</span><br><span class="line">          x: +options.pointer.x.toFixed(<span class="number">3</span>),</span><br><span class="line">          y: +options.pointer.y.toFixed(<span class="number">3</span>),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// è½ç‚¹è¿æ¥çº¿æ®µ</span></span><br><span class="line">        <span class="keyword">if</span> (lastPoint) &#123;</span><br><span class="line">          <span class="keyword">var</span> line = <span class="keyword">new</span> fabric.Line(</span><br><span class="line">            [lastPoint.x, lastPoint.y, options.pointer.x, options.pointer.y],</span><br><span class="line">            lineOption</span><br><span class="line">          );</span><br><span class="line">          canvas.add(line);</span><br><span class="line">          existLines.push(line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas.requestRenderAll();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç»˜åˆ¶å®Œæˆæˆ–å›æ˜¾æ—¶åˆ™å°†é¼ æ ‡è¿æ¥çº¿éšè—, åˆ‡æ¢å®ŒæˆçŠ¶æ€, é€šè¿‡å·²ç»˜åˆ¶çš„ç‚¹è¿æ¥ç”Ÿæˆå¤šè¾¹å½¢,è€Œé‡ç½®åˆ™æ¸…ç©ºç”»å¸ƒå¹¶é‡ç½®çŠ¶æ€å³å¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤šè¾¹å½¢å›æ˜¾</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">drowPolygon</span>(<span class="params">points</span>) </span>&#123;</span><br><span class="line">        isCompelete = <span class="literal">true</span>;</span><br><span class="line">        polygon.set(<span class="string">&quot;points&quot;</span>, points);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>åç»­å†ä¼˜åŒ–çš„è¯ å…¶å®å¯ä»¥å¼€æ”¾fabricå¤šè¾¹å½¢çš„é”šç‚¹æ‹–æ‹½,æ—‹è½¬,å½¢å˜ç­‰ç­‰</p>
<p><a href="https://gitee.com/workthing/canvas_polycon">demoå®Œæ•´ä»£ç </a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>å·¥ä½œä¸­</tag>
      </tags>
  </entry>
</search>
