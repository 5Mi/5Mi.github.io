<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>firsttime</title>
    <url>/2016/08/17/firsttime/</url>
    <content><![CDATA[<p>å°è¯•ä¸‹hexoæ­åšå®¢,æ„Ÿè§‰è¿˜æ˜¯githubä¸‹ç”¨issueæ›´å¿«ä¸€ç‚¹å„¿?å˜›,ç”¨hexoå€’æ˜¯å¯ä»¥æœ‰å¥½çœ‹çš„ä¸»é¢˜æ¥ç”¨</p>
<p>åšå®¢åšæŒå†™ä¸‹å»çš„å¯èƒ½æ€§å¯¹æˆ‘æ¥è¯´è¿˜æœªçŸ¥= =</p>
<p>æœ‰æœºä¼šå†ä½“éªŒä¸‹hexoå§</p>
<p><a href="https://github.com/5Mi/wumi_blog">githubä¸‹ç”¨issueæ²¡äº‹å„¿ä¼šè®°ç‚¹å„¿ä¸œè¥¿</a></p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>certboté…ç½®nginx https</title>
    <url>/2021/04/26/certbot%E9%85%8D%E7%BD%AEnginx-https/</url>
    <content><![CDATA[<p>è¿˜è®°å¾—å»å¹´æœåŠ¡å™¨å¤‡æ¡ˆç”³è¯·åŸŸåæŠ˜è…¾äº†ä¸¤ä¸‰å¤©, åˆæ˜¯æ‹ç…§åˆæ˜¯ä¸Šä¼ èº«ä»½è¯çš„, è®°å¾—å½“æ—¶å›è®¿çš„ç½‘è­¦è¿˜é—®æˆ‘ç½‘ç«™å†…å®¹åšå¥½ä¸Šçº¿äº†å—? æˆ‘ç­”æ²¡æœ‰, ä»–ä¾¿å’Œæˆ‘è¯´é‚£ç­‰æˆ‘å¼„å¥½äº†å†ç”³è¯·ä¸‹, å½“æ—¶æƒ³ç€åªæ˜¯åšæŠ€æœ¯ä¸Šçš„å°è¯•ä¹Ÿæ²¡åœ¨æ„, è¿™äº‹æ”¾äº†å¥½ä¹…, å‰å‡ å¤©å‘ç°åŸŸåå±…ç„¶é€šè¿‡äº†,å¤‡æ¡ˆä¹ŸæˆåŠŸäº†, è¿™å°±å¯ä»¥æŠ˜è…¾èµ·æ¥äº†</p>
<p>é¦–å…ˆnginxé…ç½®æˆ‘æ¨èç”¨è¿™ä¸ªçº¿ä¸Šçš„<a href="https://www.digitalocean.com/community/tools/nginx">NGINXConfig</a>,å¯ä»¥æ ¹æ®é¢„è®¾æˆ–è‡ªå®šä¹‰ä¸€æ­¥æ­¥çš„é…ç½®nginx,å®Œæˆåå¯ä»¥ç›´æ¥æ‹·è´æˆ–ä¸‹è½½é…ç½®</p>
<p><img src="nginx1.png" alt="nginx1"></p>
<p>æˆ‘è¿™è¾¹æ˜¯dockerå¯åŠ¨çš„nginx,æ‰€ä»¥ä¸€å®šè¦æ³¨æ„æœ¬åœ°æŒ‚è½½ç›®å½•å’Œnginxé…ç½®ä¸­è¦å¯¹åº”ä¸€è‡´,ç”±äºå¯¹ç”Ÿæˆé…ç½®ç›®å½•çš„ä¸ç†Ÿæ‚‰å¯¼è‡´æˆ‘è¿™é‡Œé¢‘ç¹æ”¹äº†å¥½å¤šæ¬¡</p>
<p>æ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡certboté…ç½®letsencryptè¯ä¹¦äº†, è¿™é‡Œè¦æ³¨æ„çš„æ˜¯é¦–æ¬¡å¯åŠ¨å…ˆå°†nginxè®¾ç½®ä¸º<code>http</code>å³å¯,certbotç”Ÿæˆè¯ä¹¦æ—¶è¦å…ˆèƒ½è®¿é—®æ­¤æœåŠ¡, é€šè¿‡certbotçš„webrootæ¥è·å–è¯ä¹¦,certbotä¼šæ ¹æ®<code>-w</code>å‚æ•°çš„é…ç½®æŒ‡å®šè·¯å¾„,ä¹‹ååœ¨æœåŠ¡çš„è¿™ä¸ªè·¯å¾„ä¸‹æ”¾ç½®æ ¡éªŒæ–‡ä»¶,åç»­ä¼šå‘æœåŠ¡çš„è·¯å¾„(<code>-w</code>è®¾ç½®çš„)å‘èµ·è¯·æ±‚æ¥æ ¡éªŒæ–‡ä»¶,æœåŠ¡å¯è®¿é—®ä¸”æ ¡éªŒé€šè¿‡åæ‰èƒ½å¾—åˆ°è¯ä¹¦, æ‰€ä»¥å¯¹åº”nginxæ·»åŠ é…ç½®,æ³¨æ„<code>/var/www/_letsencrypt</code>å¤šå¤„è¦é…ç½®ä¸€è‡´</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx</span></span><br><span class="line"><span class="comment"># ACME-challenge</span></span><br><span class="line"><span class="string">location</span> <span class="string">^~</span> <span class="string">/.well-known/acme-challenge/</span> &#123;</span><br><span class="line">    <span class="string">root</span> <span class="string">/var/www/_letsencrypt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç”±äºnginxå’ŒcertbotæœåŠ¡éƒ½æ˜¯docker å®¹å™¨, æ‰€ä»¥å¯¹åº”çš„æ ¡éªŒè·¯å¾„è¦ä¸¤å®¹å™¨éƒ½èƒ½è¯»å†™è®¿é—®,æ‰€ä»¥<strong>è¦æ³¨æ„æŠŠæ ¡éªŒè·¯å¾„é…ç½®ä¸€è‡´,æŒ‚è½½åˆ°æœ¬åœ°åŒä¸€ç›®å½•</strong>, æ­¤å¤„æˆ‘å°†<code>/var/www/_letsencrypt</code>ç»Ÿä¸€æŒ‚è½½åˆ°<code>/home/nginx</code>,nginxçš„æœ¬åœ°æŒ‚è½½ç›®å½•ä¸‹</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># certbotçš„docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span>      </span><br><span class="line">  <span class="attr">docker_certbot:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">certbot/certbot</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">certbot</span></span><br><span class="line">    <span class="attr">volumes:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/letsencrypt:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/var/lib/letsencrypt:/var/lib/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx:/var/www/_letsencrypt</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">certonly</span> <span class="string">--webroot</span> <span class="string">-d</span> <span class="string">www.mimimimimi.top</span> <span class="string">--email</span> <span class="number">393223434</span><span class="string">@qq.com</span> <span class="string">-w</span> <span class="string">/var/www/_letsencrypt</span> <span class="string">-n</span> <span class="string">--agree-tos</span> <span class="string">--force-renewal</span></span><br></pre></td></tr></table></figure>

<p>certbotå¾—åˆ°è¯ä¹¦å,nginxåŒæ ·éœ€è¦å¯è¯», æ‰€ä»¥å°†ä¸¤æœåŠ¡å¾—è¯ä¹¦ç›®å½•ç»Ÿä¸€æŒ‚è½½åˆ°æœ¬åœ°åŒç›®å½•<code>/etc/letsencrypt</code>ä¸‹,æ­¤æ—¶å†å°†nginxé…ç½®æˆ<code>https</code>,æ³¨æ„nginxé…ç½®ä¸­å¯¹åº”ssléƒ¨åˆ†è¦åšç›¸åº”ä¿®æ”¹,ç›®å½•ä¸€è‡´ ä¾‹å¦‚:</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># SSL</span></span><br><span class="line"><span class="string">ssl_certificate</span>         <span class="string">/etc/letsencrypt/live/mimimimimi.top/fullchain.pem;</span></span><br><span class="line"><span class="string">ssl_certificate_key</span>     <span class="string">/etc/letsencrypt/live/mimimimimi.top/privkey.pem;</span></span><br><span class="line"><span class="string">ssl_trusted_certificate</span> <span class="string">/etc/letsencrypt/live/mimimimimi.top/chain.pem;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nginx çš„ docker-compose.yml</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span>    <span class="comment"># æŒ‡å®š docker-compose.yml æ–‡ä»¶çš„å†™æ³•æ ¼å¼</span></span><br><span class="line"><span class="attr">services:</span>       <span class="comment"># å¤šä¸ªå®¹å™¨é›†åˆ</span></span><br><span class="line">  <span class="attr">docker_nginx:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">root</span>  <span class="comment"># ä¸ºäº†é¿å…ä¸€äº›æƒé™é—®é¢˜ åœ¨è¿™æˆ‘ä½¿ç”¨äº†root</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span> <span class="comment"># é‡å¯æ–¹å¼</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx</span> <span class="comment"># å®¹å™¨åç§°</span></span><br><span class="line">    <span class="attr">ports:</span>      <span class="comment"># å¯¹å¤–æš´éœ²çš„ç«¯å£å®šä¹‰</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;80:80&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;443:443&#x27;</span></span><br><span class="line">    <span class="attr">volumes:</span>    <span class="comment"># å·æŒ‚è½½è·¯å¾„ é˜²æ­¢æŒ‚è½½è¦†ç›–</span></span><br><span class="line">      <span class="comment"># /home/nginx:/etc/nginx å­˜åœ¨é»˜è®¤æ–‡ä»¶ä¸¢å¤±</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/nginxconfig.io:/etc/nginx/nginxconfig.io</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/sites-enabled:/etc/nginx/sites-enabled</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/sites-available:/etc/nginx/sites-available</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx/public:/var/www/mimimimimi.top/public</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/etc/letsencrypt:/etc/letsencrypt</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/home/nginx:/var/www/_letsencrypt</span> <span class="comment"># é…åˆcertbot, letsencryptæ ¡éªŒç”¨</span></span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹ååˆ«å¿˜äº†é‡å¯nginxé•œåƒ</p>
<p>ç”±äºå…è´¹è¯ä¹¦90å¤©å¤±æ•ˆ,ä¹‹åè¿˜å¯ä»¥åœ¨æœåŠ¡å™¨ä¸­é€šè¿‡<code>crontab</code>è®¾ç½®å®šæ—¶ä»»åŠ¡é‡èµ·certbotå®¹å™¨,æ¥é‡æ–°ç”Ÿæˆè¯ä¹¦</p>
<p><a href="https://www.digitalocean.com/community/tools/nginx?domains.0.https.letsEncryptEmail=393223434@qq.com&domains.0.logging.accessLog=true&domains.0.logging.errorLog=true&domains.0.php.php=false&domains.0.reverseProxy.reverseProxy=true&domains.0.reverseProxy.path=/forProxy&domains.0.reverseProxy.proxyPass=http://127.0.0.1:9999&domains.0.routing.index=index.html&domains.0.routing.fallbackHtml=true&domains.0.routing.fallbackPhp=false&domains.0.server.domain=mimimimimi.top&domains.0.server.wwwSubdomain=true&global.docker.dockerCompose=true&global.nginx.user=nginx&global.nginx.pid=/var/run/nginx.pid">å‚è€ƒä¿®æ”¹</a><br><a href="https://certbot.eff.org/docs/install.html#running-with-docker">certbot running-with-docker</a><br><a href="https://certbot.eff.org/docs/using.html#webroot">certbot webroot</a><br><a href="https://segmentfault.com/a/1190000005797776">å‚è€ƒ</a><br><a href="https://www.cnblogs.com/gao88/p/10596143.html">å®šæ—¶æ›´æ–°å‚è€ƒ</a><br><a href="https://gitee.com/mimimimimi/docker_nginx_certbot">ä»£ç ç•™å­˜</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>docker</tag>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>hexo again</title>
    <url>/2021/04/25/hexoagain/</url>
    <content><![CDATA[<p>æ—¶éš”å¤šå¹´å†æ¬¡æ›´æ–°ä¸‹blog, æ›´æ–°ä¸‹ä¸»é¢˜, æƒ³ç€è®°å½•ç‚¹å„¿ä»€ä¹ˆ~</p>
]]></content>
      <categories>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨fabricå®Œæˆå¤šè¾¹å½¢é€‰åŒº</title>
    <url>/2021/05/06/%E4%BD%BF%E7%94%A8fabric%E5%AE%8C%E6%88%90%E5%A4%9A%E8%BE%B9%E5%BD%A2%E9%80%89%E5%8C%BA/</url>
    <content><![CDATA[<p><img src="draw.gif" alt="a"></p>
<p>ä¹‹å‰æœ‰è¿‡è¿™ä¹ˆä¸ªéœ€æ±‚, è¯´æ˜¯è¦åœ¨å›¾ç‰‡ä¸­é€‰åŒº(è½¦ç«™,å¹¿åœºç­‰),ç„¶åé€‰åŒºçš„è¦æ±‚æ˜¯<strong>ä¸è§„åˆ™å‡¸å¤šè¾¹å½¢</strong> <strong>æŒ‰ç‚¹è¿æ¥</strong>, ä¹‹åè¦è·å–é€‰åŒºç‚¹åæ ‡, åŒæ—¶ä¹Ÿæœ‰å°†ç”Ÿæˆç‚¹åæ ‡å›æ˜¾å±•ç¤ºé€‰åŒºçš„éœ€æ±‚, åœ¨ä¸€ç•ªè°ƒç ”ä¹‹åå†³å®šä½¿ç”¨<a href="http://fabricjs.com/">fabric.js</a>æ¥å®ç°åŠŸèƒ½</p>
<blockquote>
<p>Fabricæ˜¯ä¸€ä¸ªå¼ºå¤§è€Œç®€å•çš„JS Canvasåº“ï¼Œæˆ‘ä»¬èƒ½é€šè¿‡ä½¿ç”¨å®ƒå®ç°åœ¨Canvasä¸Šåˆ›å»ºã€å¡«å……å›¾å½¢ã€ç»™å›¾å½¢å¡«å……æ¸å˜é¢œè‰²ã€‚ ç»„åˆå›¾å½¢ï¼ˆåŒ…æ‹¬ç»„åˆå›¾å½¢ã€å›¾å½¢æ–‡å­—ã€å›¾ç‰‡ç­‰ï¼‰ç­‰ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ç®€å•æ¥è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨Fabricä»è€Œä»¥è¾ƒä¸ºç®€å•çš„æ–¹å¼å®ç°è¾ƒä¸ºå¤æ‚çš„CanvasåŠŸèƒ½</p>
</blockquote>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>æ•´ä¸ªçš„æ€è·¯å¤§æ¦‚æ˜¯å…ˆåˆå§‹åŒ–fabricå®ä¾‹,å°†å›¾ç‰‡å±•ç¤ºåˆ°canvasä¸Š,æ ¹æ®å›¾ç‰‡å’Œcanvasçš„å°ºå¯¸å¾—åˆ°ç¼©æ”¾æ¯”ä¾‹,æ–¹ä¾¿å°†åç»­å¾—åˆ°çš„ç‚¹åæ ‡æŒ‰å›¾ç‰‡å°ºå¯¸è¿˜åŸ.æ¥ç€é€šè¿‡é¼ æ ‡ç‚¹å‡»åœ¨canvasä¸Šç»˜åˆ¶ç‚¹,å°†ç‚¹æŒ‰ç…§ç‚¹å‡»é¡ºåºè¿æ¥æˆçº¿,åˆ™å¾—åˆ°å¤šè¾¹å½¢çš„è¾¹,æ­¤æ—¶ä¸‰ä¸ªç‚¹ä»¥ä¸Šåˆ™å¯è¿æ¥æˆå¤šè¾¹å½¢,å½“ç‚¹å‡»å®Œæˆæ—¶å°†<strong>èµ·å§‹ç‚¹</strong>ä¸<strong>ç»ˆç‚¹</strong>è¿æ¥é—­åˆæˆå¤šè¾¹å½¢.</p>
<p><img src="draw-close.png" alt="draw-close"></p>
<p>å…¶ä¸­æ ¸å¿ƒçš„é—®é¢˜åˆ™æ˜¯æŒ‰é¡ºåºè¿æ¥çš„ç‚¹,å½“å›¾å½¢å®Œæˆ,èµ·å§‹ç‚¹å’Œç»ˆç‚¹è¿æ¥æ—¶,é€‰åŒºå›¾å½¢æ˜¯å¦èƒ½æˆä¸ºä¸€ä¸ªå¤šè¾¹å½¢?æ­¤å¤„æˆ‘é‡‡ç”¨çš„æ–¹å¼æ˜¯, é€šè¿‡é¼ æ ‡ç§»åŠ¨,å¯ä»¥è½ç‚¹æ—¶é¼ æ ‡åŒé¦–å°¾ç‚¹è¿æ¥è™šçº¿,å½“æ— æ³•ç»˜åˆ¶æ‰€éœ€å¤šè¾¹å½¢æ—¶éšè—è™šçº¿å¹¶<strong>æ— æ³•è½ç‚¹</strong>,ç¡®ä¿å·²ç»ç»˜åˆ¶çš„ç‚¹ä¹‹é—´å¯è¿æˆå¤šè¾¹å½¢</p>
<p><img src="draw-cross.png" alt="draw-cross"></p>
<p>å³æ ¸å¿ƒçš„åˆ¤æ–­åˆ™æ˜¯:</p>
<ul>
<li>èµ·å§‹ç‚¹ä¸é¼ æ ‡è¿çº¿:line1,ç»ˆç‚¹ä¸é¼ æ ‡è¿çº¿:line2,åˆ™line1,line2æ˜¯å¦<strong>åŒæ—¶</strong>ä¸å·²è¿æ¥çš„çº¿æ®µ<strong>ç›¸äº¤</strong>, åŒæ—¶ç›¸äº¤åˆ™æ— æ³•è½ç‚¹<br><img src="draw2.png" alt="draw2"></li>
<li><strong>å·²è¿æ¥çº¿æ®µä¸­é™¤é¦–å°¾ä¸¤æ¡å¤–</strong>, æ˜¯å¦å­˜åœ¨line1<strong>æˆ–</strong>line2ä¸æŸæ¡çº¿æ®µç›¸äº¤, ç›¸äº¤åˆ™æ— æ³•è½ç‚¹<br><img src="draw3.png" alt="draw3"></li>
<li>é€šè¿‡å‘é‡å‰ä¹˜åˆ¤æ–­çº¿æ®µç›¸äº¤<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// è®¡ç®—å‘é‡å‰ä¹˜</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">crossMul</span>(<span class="params">v1, v2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v1.x * v2.y - v1.y * v2.x;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// åˆ¤æ–­ä¸¤æ¡çº¿æ®µæ˜¯å¦ç›¸äº¤line1(p1,p2) line2(p3,p4)</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">checkCross</span>(<span class="params">p1, p2, p3, p4</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> v1 = &#123; <span class="attr">x</span>: p1.x - p3.x, <span class="attr">y</span>: p1.y - p3.y &#125;,</span><br><span class="line">      v2 = &#123; <span class="attr">x</span>: p2.x - p3.x, <span class="attr">y</span>: p2.y - p3.y &#125;,</span><br><span class="line">      v3 = &#123; <span class="attr">x</span>: p4.x - p3.x, <span class="attr">y</span>: p4.y - p3.y &#125;,</span><br><span class="line">      v = crossMul(v1, v3) * crossMul(v2, v3);</span><br><span class="line">    v1 = &#123; <span class="attr">x</span>: p3.x - p1.x, <span class="attr">y</span>: p3.y - p1.y &#125;;</span><br><span class="line">    v2 = &#123; <span class="attr">x</span>: p4.x - p1.x, <span class="attr">y</span>: p4.y - p1.y &#125;;</span><br><span class="line">    v3 = &#123; <span class="attr">x</span>: p2.x - p1.x, <span class="attr">y</span>: p2.y - p1.y &#125;;</span><br><span class="line">    <span class="keyword">return</span> v &lt;= <span class="number">0</span> &amp;&amp; crossMul(v1, v3) * crossMul(v2, v3) &lt;= <span class="number">0</span></span><br><span class="line">      ? <span class="literal">true</span></span><br><span class="line">      : <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<hr>
<h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>é¦–å…ˆé¡µé¢ä¸Šè¦æœ‰ä¸ªcanvaså®¹å™¨,æ®æ­¤ç”Ÿæˆfabricçš„canvaså®ä¾‹,è¿˜è¦å°†å›¾ç‰‡å±•ç¤ºåœ¨canvasä¸­,ç„¶åæ ¹æ®å›¾ç‰‡å°ºå¯¸,canvaså°ºå¯¸å¾—åˆ°å±•ç¤ºçš„ç¼©æ”¾æ¯”ä¾‹<code>radio</code></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> convasDefaultWidth = <span class="number">500</span>;</span><br><span class="line">      <span class="comment">//</span></span><br><span class="line">      <span class="keyword">var</span> image = <span class="keyword">new</span> fabric.Image(<span class="built_in">document</span>.getElementById(<span class="string">&quot;image&quot;</span>));</span><br><span class="line">      <span class="keyword">var</span> imageWidth = image.get(<span class="string">&quot;width&quot;</span>);</span><br><span class="line">      <span class="keyword">var</span> canvasWidth =</span><br><span class="line">        imageWidth &gt; convasDefaultWidth ? convasDefaultWidth : imageWidth;</span><br><span class="line">      <span class="comment">// ç¼©æ”¾æ¯”ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> radio = imageWidth / canvasWidth;</span><br><span class="line">      <span class="comment">// fabfricå®ä¾‹</span></span><br><span class="line">      <span class="keyword">var</span> canvas = <span class="keyword">new</span> fabric.Canvas(<span class="string">&quot;canvas&quot;</span>, &#123;</span><br><span class="line">        width: canvasWidth,</span><br><span class="line">        height: image.get(<span class="string">&quot;height&quot;</span>) / radio,</span><br><span class="line">        backgroundImage: image.scaleToWidth(canvasWidth),</span><br><span class="line">        backgroundColor: <span class="string">&#x27;transparent&#x27;</span>,</span><br><span class="line">        selection:<span class="literal">false</span></span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>
<p>å½“ç»˜åˆ¶å®Œæˆæˆ–å›æ˜¾æ—¶, ç›´æ¥ä½¿ç”¨fabricç»˜åˆ¶å¤šè¾¹å½¢å³å¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> polygon = <span class="keyword">new</span> fabric.Polygon([], &#123;</span><br><span class="line">        strokeWidth: <span class="number">2</span>,</span><br><span class="line">        stroke: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">        fill: <span class="string">&quot;transparent&quot;</span>,</span><br><span class="line">        objectCaching: <span class="literal">false</span>,</span><br><span class="line">        <span class="comment">// transparentCorners: false,</span></span><br><span class="line">        <span class="comment">// cornerColor: &quot;blue&quot;,</span></span><br><span class="line">      &#125;);</span><br><span class="line">      <span class="comment">// æ·»åŠ åˆ°ç”»å¸ƒ</span></span><br><span class="line">      canvas.add(polygon);</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–å„ä¸ªçŠ¶æ€,ä»¥åŠå°†æ¥é¼ æ ‡æ˜¾ç¤ºçš„è¿æ¥çº¿ç­‰</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å·²ç»˜åˆ¶ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> points = [];</span><br><span class="line"><span class="comment">// å½“å‰æ˜¯å¦å¯ä»¥è½ç‚¹</span></span><br><span class="line"><span class="keyword">var</span> canAddPoint = <span class="literal">true</span>;</span><br><span class="line"><span class="comment">// å·²å­˜åœ¨çº¿æ®µ</span></span><br><span class="line"><span class="keyword">var</span> existLines = [];</span><br><span class="line"><span class="comment">// ç»˜åˆ¶æ˜¯å¦å®Œæˆ</span></span><br><span class="line"><span class="keyword">var</span> isCompelete = <span class="literal">false</span>;</span><br><span class="line"><span class="comment">// çº¿æ®µé»˜è®¤é…ç½®</span></span><br><span class="line"><span class="keyword">var</span> lineOption = &#123;</span><br><span class="line">  strokeWidth: <span class="number">2</span>,</span><br><span class="line">  stroke: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  fill: <span class="string">&quot;green&quot;</span>,</span><br><span class="line">  selectable: <span class="literal">false</span>,</span><br><span class="line">  evented: <span class="literal">false</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// è¿æ¥çº¿ä½¿ç”¨è™šçº¿</span></span><br><span class="line"><span class="keyword">var</span> dashLineOption = <span class="built_in">Object</span>.assign(&#123;&#125;,lineOption,&#123;<span class="attr">strokeDashArray</span>: [<span class="number">10</span>, <span class="number">15</span>]&#125;)</span><br><span class="line"><span class="comment">// é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line"><span class="keyword">var</span> combineLineWithFirst = <span class="keyword">new</span> fabric.Line([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], dashLineOption);</span><br><span class="line"><span class="keyword">var</span> combineLineWithSecond = <span class="keyword">new</span> fabric.Line([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], dashLineOption);</span><br><span class="line"><span class="comment">// æ·»åŠ è‡³canvas</span></span><br><span class="line">canvas.add(combineLineWithFirst);</span><br><span class="line">canvas.add(combineLineWithSecond);</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–fabric canvasçš„é¼ æ ‡äº‹ä»¶,å³é¼ æ ‡ç§»åŠ¨å’Œç‚¹å‡»</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç§»åŠ¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canvasHandleMouseMove</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> pointsLen = points.length;</span><br><span class="line">  <span class="keyword">if</span> (pointsLen === <span class="number">0</span>) <span class="keyword">return</span>;</span><br><span class="line">  <span class="comment">// èµ·ç‚¹ä¸ç»ˆç‚¹</span></span><br><span class="line">  <span class="keyword">var</span> firstPoint = points[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> lastPoint = points[pointsLen - <span class="number">1</span>];</span><br><span class="line">  <span class="comment">// ä¸¤ç‚¹ä»¥ä¸Š</span></span><br><span class="line">  <span class="keyword">if</span> (pointsLen &gt; <span class="number">2</span>) &#123;</span><br><span class="line">    <span class="comment">// å·²ç»˜åˆ¶çš„çº¿æ®µ</span></span><br><span class="line">    <span class="keyword">var</span> exlines = getLinesArr();</span><br><span class="line">    <span class="keyword">var</span> hasCross = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; exlines.length; i++) &#123;</span><br><span class="line">      <span class="keyword">var</span> perline = exlines[i];</span><br><span class="line">      <span class="keyword">var</span> point1 = &#123; <span class="attr">x</span>: perline[<span class="number">0</span>], <span class="attr">y</span>: perline[<span class="number">1</span>] &#125;;</span><br><span class="line">      <span class="keyword">var</span> point2 = &#123; <span class="attr">x</span>: perline[<span class="number">2</span>], <span class="attr">y</span>: perline[<span class="number">3</span>] &#125;;</span><br><span class="line">      <span class="comment">// æ ¹æ®ä¹‹å‰æ‰€è¯´çš„åˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">      <span class="comment">// line1,line2æ˜¯å¦åŒæ—¶ä¸å·²è¿æ¥çš„çº¿æ®µç›¸äº¤</span></span><br><span class="line">      <span class="comment">// æˆ– å­˜åœ¨line1æˆ–line2ä¸æŸæ¡çº¿æ®µç›¸äº¤</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        checkCross(options.pointer, firstPoint, point1, point2) &amp;&amp;</span><br><span class="line">        checkCross(options.pointer, lastPoint, point1, point2)</span><br><span class="line">      ) &#123;</span><br><span class="line">        hasCross = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &gt; <span class="number">0</span> &amp;&amp; i &lt; exlines.length - <span class="number">1</span> &amp;&amp; (checkCross(options.pointer, firstPoint, point1, point2) ||</span><br><span class="line">      checkCross(options.pointer, lastPoint, point1, point2)))&#123;</span><br><span class="line">        hasCross = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// èƒ½è½ç‚¹, ç»˜åˆ¶é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line">  <span class="keyword">if</span> (!hasCross) &#123;</span><br><span class="line">    canAddPoint = <span class="literal">true</span>;</span><br><span class="line">    setLineWithPoint(combineLineWithFirst, options.pointer, firstPoint);</span><br><span class="line">    setLineWithPoint(combineLineWithSecond, options.pointer, lastPoint);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// éšè—é¼ æ ‡è¿æ¥çº¿</span></span><br><span class="line">    canAddPoint = <span class="literal">false</span>;</span><br><span class="line">    setLineWithPoint(combineLineWithFirst);</span><br><span class="line">    setLineWithPoint(combineLineWithSecond);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// fabric ç»˜åˆ¶</span></span><br><span class="line">  canvas.renderAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç‚¹å‡»</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">canvasHandleMouseDown</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!canAddPoint) <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">        <span class="keyword">var</span> pointsLen = points.length;</span><br><span class="line">        <span class="keyword">var</span> lastPoint = points[pointsLen - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">          lastPoint &amp;&amp;</span><br><span class="line">          options.pointer.x === lastPoint.x &amp;&amp;</span><br><span class="line">          options.pointer.y === lastPoint.y</span><br><span class="line">        )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">// console.log(options, options.pointer.x, options.pointer.y);</span></span><br><span class="line">        <span class="comment">// è½ç‚¹, æ³¨æ„ç²¾åº¦</span></span><br><span class="line">        points.push(&#123;</span><br><span class="line">          x: +options.pointer.x.toFixed(<span class="number">3</span>),</span><br><span class="line">          y: +options.pointer.y.toFixed(<span class="number">3</span>),</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// è½ç‚¹è¿æ¥çº¿æ®µ</span></span><br><span class="line">        <span class="keyword">if</span> (lastPoint) &#123;</span><br><span class="line">          <span class="keyword">var</span> line = <span class="keyword">new</span> fabric.Line(</span><br><span class="line">            [lastPoint.x, lastPoint.y, options.pointer.x, options.pointer.y],</span><br><span class="line">            lineOption</span><br><span class="line">          );</span><br><span class="line">          canvas.add(line);</span><br><span class="line">          existLines.push(line);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        canvas.requestRenderAll();</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>å½“ç»˜åˆ¶å®Œæˆæˆ–å›æ˜¾æ—¶åˆ™å°†é¼ æ ‡è¿æ¥çº¿éšè—, åˆ‡æ¢å®ŒæˆçŠ¶æ€, é€šè¿‡å·²ç»˜åˆ¶çš„ç‚¹è¿æ¥ç”Ÿæˆå¤šè¾¹å½¢,è€Œé‡ç½®åˆ™æ¸…ç©ºç”»å¸ƒå¹¶é‡ç½®çŠ¶æ€å³å¯</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å¤šè¾¹å½¢å›æ˜¾</span></span><br><span class="line">      <span class="function"><span class="keyword">function</span> <span class="title">drowPolygon</span>(<span class="params">points</span>) </span>&#123;</span><br><span class="line">        isCompelete = <span class="literal">true</span>;</span><br><span class="line">        polygon.set(<span class="string">&quot;points&quot;</span>, points);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>

<p>åç»­å†ä¼˜åŒ–çš„è¯ å…¶å®å¯ä»¥å¼€æ”¾fabricå¤šè¾¹å½¢çš„é”šç‚¹æ‹–æ‹½,æ—‹è½¬,å½¢å˜ç­‰ç­‰</p>
<p><a href="https://gitee.com/workthing/canvas_polycon">demoå®Œæ•´ä»£ç </a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>å·¥ä½œä¸­</tag>
      </tags>
  </entry>
  <entry>
    <title>è®°ä¸€æ¬¡jenkinsç›¸å…³è¢«æŒ–çŸ¿å¤„ç†çš„åº”å¯¹</title>
    <url>/2021/04/27/jenkins-bug/</url>
    <content><![CDATA[<h3 id="å‰ç½®"><a href="#å‰ç½®" class="headerlink" title="å‰ç½®"></a>å‰ç½®</h3><p>äº‹ä»¶çš„èµ·æºå…¶å®æ˜¯ä¸Šæ¬¡æ›´æ–°blogåçš„ç–‘é—®</p>
<blockquote>
<p>æ—¶éš”å¤šå¹´å†æ¬¡æ›´æ–°ä¸‹blog, æ›´æ–°ä¸‹ä¸»é¢˜, æƒ³ç€è®°å½•ç‚¹å„¿ä»€ä¹ˆ~</p>
</blockquote>
<p>è™½è¯´æƒ³æ³•æ˜¯å¥½çš„, ä½†ä½œä¸ºä¸€ä¸ªèµ„æ·±<code>æ²‰é»˜çš„è§‚å¯Ÿå‘˜</code>çš„æˆ‘, è‡ªç„¶æ˜¯ <code>å½“æˆ‘æ²‰é»˜ç€çš„æ—¶å€™,æˆ‘è§‰å¾—å……å®,æˆ‘å°†å¼€å£,åŒæ—¶æ„Ÿåˆ°ç©ºè™š</code>, æ‰€ä»¥å¹³æ—¶çœ‹çœ‹è¿˜å¥½, çœŸè¦å¼ å˜´é©¬ä¸Šæ— è¯å¯è¯´äº†, å¹³æ—¶æ²¡äº‹å„¿å°±æ€è€ƒäººç”Ÿ,æƒ³èµ·è‡ªå·±æ¯•ä¸šæ—¶å†™çš„ä¸€ä¸ªé™æ€é¡µé¢, é‚£æ˜¯ä¸€ä¸ªä»‹ç»æˆ‘å½“æ—¶ç©çš„æ¸¸æˆçš„å°é¡µé¢, æƒ³ç€æ­£å¥½æœåŠ¡å™¨,åŸŸåéƒ½ç©ºç€æ²¡ç”¨, ä¸å¦¨æŠŠè¿™ä¸ªå½“æ—¶ç…§ç€è§†é¢‘æ•™ç¨‹å¼€å‘çš„å°é¡µé¢æ”¾ä¸Šå»è¯•è¯•, ä¹Ÿç®—çºªå¿µä¸‹å›å½’åˆå¿ƒ</p>
<p>è¯´å¹²å°±å¹², æœ¬åœ°sshç™»å½•æœåŠ¡å™¨æ—¶å´ç™»ä¸ä¸Š, ä¹‹å‰å¯èƒ½å¡äº†ç‚¹è¿˜æ€»æ–­,ä½†å¥½æ­¹æ˜¯èƒ½ç™»ä¸Šçš„, è¿™å›<code>ssh -i</code>æŒ‡å®šå¯†é’¥çš„æƒ…å†µä¸‹å´ä»æç¤ºè¾“å…¥å¯†ç , å“ªæ€•å¯†ç æ­£ç¡®(ç‰¹æ„é‡ç½®äº†ğŸ˜­)ä¹Ÿä¸æ–­æç¤ºé‡æ–°è¾“å…¥å¯†ç ç›´åˆ°<code>Permission denied</code>, æ˜æ˜æŒ‡å®šå¯†é’¥ä¸éœ€è¦å†è¾“å¯†ç æ¥ç€, çœ‹æ¥æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜, åˆ°æ§åˆ¶å°ç½‘é¡µç™»å½•,å‘ç°å¯†é’¥/å¯†ç éƒ½æ˜¯okçš„, åªå¥½ç¿»ç¿»<a href="https://cloud.tencent.com/document/product/213/35574#ssh-.E9.97.AE.E9.A2.98.E5.AF.BC.E8.87.B4.E6.97.A0.E6.B3.95.E7.99.BB.E5.BD.95">æ–‡æ¡£</a>æ‰¾è§£å†³æ–¹æ¡ˆ</p>
<h3 id="åº”å¯¹"><a href="#åº”å¯¹" class="headerlink" title="åº”å¯¹"></a>åº”å¯¹</h3><p>ä¸€æ¡æ¡å¯¹ä¸‹æ¥å‘ç°æœ‰æ¡å¯¹åº”<strong>æœåŠ¡å™¨é«˜è´Ÿè½½</strong>ç›¸å…³çš„, åˆ°å®ä¾‹ç›‘æ§ä¸Šçœ‹, å¥½å˜›, cpuæœç„¶å·²ç»é£™åˆ°æé™äº†</p>
<p><img src="tencentdoc.png" alt="tencentdoc"><br><img src="cloudserve.png" alt="cloudserve"></p>
<ul>
<li><p>åœ¨ä¸€é€šæœç´¢ä¸‹å¾—çŸ¥, é€šè¿‡<code>top</code>å‘½ä»¤æŸ¥çœ‹å½“å‰cpuè¿è¡Œç›¸å…³çŠ¶æ€</p>
<p><img src="termial_1.png" alt="termial_1.png"></p>
</li>
<li><p>é€šè¿‡è¾“å…¥k æŒ‡å®špid,æˆ‘ä»¬å¯ä»¥ç›´æ¥killæ‰å ç”¨cpuè¿‡é«˜çš„traceè¿›ç¨‹, ä½†å¤šæ¬¡æ€è¿›ç¨‹è¿™ä¸ªtraceå´æ€»ä¼šé‡å¯, æ¥ç€æˆ‘ä»¬é€šè¿‡<code>PID</code>æ¥æ‰¾åˆ°å¯¹åº”è¿›ç¨‹å’Œæ‰€åœ¨ç›®å½•, pidçš„æŸ¥çœ‹é™¤<code>top</code>å¤–ä¹Ÿå¯ä½¿ç”¨</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ps -ef |grep [Pname è¿›ç¨‹å]</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šå›¾çš„æœ€åè¿è¡Œ<code>ps -ef |grep trace</code>çš„è¿”å›å¯è§åˆ°ä¸€äº›å…³é”®ä¿¡æ¯, åƒä»€ä¹ˆ<code>mine.c3pool.com</code>ä¸€çœ‹å°±æ˜¯è€çŸ¿å·¥äº†, <code>2020jenkins</code>å¯èƒ½å°±æ˜¯å›å˜é©å‘½çš„å…ƒå‡¶</p>
</li>
<li><p>é€šè¿‡<code>PID</code>æ¥æ‰¾åˆ°å¯¹åº”è¿›ç¨‹å’Œæ‰€åœ¨ç›®å½•åˆ™ä½¿ç”¨, å…¶ä¸­ <strong>/procç›®å½•ä¸­åŒ…å«è®¸å¤šä»¥æ•°å­—å‘½åçš„å­ç›®å½•ï¼Œè¿™äº›æ•°å­—è¡¨ç¤ºç³»ç»Ÿå½“å‰æ­£åœ¨è¿è¡Œè¿›ç¨‹çš„è¿›ç¨‹å·ï¼Œé‡Œé¢åŒ…å«å¯¹åº”è¿›ç¨‹ç›¸å…³çš„å¤šä¸ªä¿¡æ¯æ–‡ä»¶</strong></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ls -l /proc/[PID]</span><br><span class="line">å½“ç„¶ç›´æ¥ <span class="built_in">cd</span> /proc/[PID] å† llä¹Ÿæ˜¯ä¸€æ ·çš„</span><br><span class="line">å†å°±æ˜¯</span><br><span class="line">pwdx [PID]</span><br></pre></td></tr></table></figure>
<p>å½“æ—¶å¿˜äº†æˆªå›¾, åº”è¯¥å’Œä»¥ä¸‹ç›¸ä¼¼, å½“æ—¶çš„exeå’Œpwdéƒ½æŒ‡å‘ <code>/var/jenkins_home/XXX../trace</code>ä½†æˆ‘æœåŠ¡å™¨æœ¬åœ°æ˜¯æ²¡æœ‰è¿™ä¸ªç›®å½•çš„<br><img src="terminal_3.png" alt="terminal"><br>è€ƒè™‘åˆ°æˆ‘çš„jenkinsæ˜¯dockerèµ·çš„, é©¬ä¸Šæ‰¾åˆ°å¯¹åº”çš„æŒ‚è½½ç›®å½•, ä»<code>jenkins_home</code>ä¸€è·¯æ‰¾åˆ°è¿™ä¸ª<code>trace</code>, ä½†å‘ç°å°±ç®—å°†traceåˆ é™¤å®ƒä¹Ÿé©¬ä¸Šä¼šå†è‡ªåŠ¨ç”ŸæˆğŸ˜±,æ¥ä¸‹æ¥é€šè¿‡<strong>jenkins</strong>ä½œä¸ºå…³é”®å­—é€šè¿‡ç½‘ç»œæœç´¢æœç„¶èƒ½å‘ç°äº›ç«¯å€ª, å‚è€ƒ<a href="https://www.jianshu.com/p/70e071113044?from=groupmessage&isappinstalled=0">è¿™ç¯‡</a>å’Œ<a href="https://blog.csdn.net/g6U8W7p06dCO99fQ3/article/details/90205674">è¿™ç¯‡</a>åŸºæœ¬ä¸Šèƒ½ç¡®å®šæˆ‘ç¢°ä¸Šçš„ä¹Ÿæ˜¯è¿™ç§æƒ…å†µäº†,ç™»ä¸Šjenkinsä¸€çœ‹æœç„¶å†ä¸€ç›´é‡å¤è·‘ç€å‡ ä¸ªä¸æ˜¯æˆ‘å»ºçš„build<br><img src="jenkins_dashbord.png" alt="jenkins_dashbord"></p>
</li>
</ul>
<p>ä¹‹åå¤„ç†åˆ™æ˜¯æŒ‰ç…§ä»¥ä¸‹é¡ºåº:</p>
<ul>
<li>ç¦ç”¨Jenkins task</li>
<li>å‡çº§Jenkinsç‰ˆæœ¬</li>
<li>æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬</li>
</ul>
<h3 id="å‡çº§Jenkinsç‰ˆæœ¬"><a href="#å‡çº§Jenkinsç‰ˆæœ¬" class="headerlink" title="å‡çº§Jenkinsç‰ˆæœ¬"></a>å‡çº§Jenkinsç‰ˆæœ¬</h3><p>ç¦ç”¨Jenkins taskä¸å¿…å¤šè¨€ç›´æ¥åœ¨é¡µé¢ä¸Šè®¾ç½®ç¦ç”¨å³å¯, ä¸»è¦æ˜¯å‡çº§Jenkinsç‰ˆæœ¬, é¡µé¢ä¸Šä¹Ÿæœ‰æç¤ºå‡çº§,ç‚¹å‡»å´ä¸€ç›´å‡çº§å¤±è´¥(å¯èƒ½æ˜¯ç½‘ç»œç­‰åŸå› ,å…³é”®æ–‡ä»¶ä¸‹è½½å¤±è´¥ä¹‹ç±»çš„,è¿™ä¸æ˜¯å¾ˆå¸¸è§å—), é‰´äºæˆ‘çš„jenkinsæ˜¯dockerè·‘çš„, å‚è€ƒç½‘ä¸Šçš„ä¸€äº›æ–‡ç« ,é€šè¿‡æ›´æ–°å®¹å™¨ä¸­çš„waråŒ…æ¥å‡çº§jenkins:</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿›å…¥jenkinså®¹å™¨</span></span><br><span class="line">docker <span class="built_in">exec</span> -it [jenkins contanerID] sh</span><br><span class="line"></span><br><span class="line"><span class="comment">#ä¸‹è½½æ–°åŒ…</span></span><br><span class="line"><span class="built_in">cd</span> /var/jenkins</span><br><span class="line">wget http://mirrors.jenkins.io/war/latest/jenkins.war</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥waråŒ…çš„å­˜æ”¾è·¯å¾„ï¼Œå¤‡ä»½æ—§åŒ…ï¼Œæ–°åŒ…ä»£æ›¿</span></span><br><span class="line">somehost$:/<span class="comment"># cd /usr/share/jenkins/</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># ls</span></span><br><span class="line">jenkins.war</span><br><span class="line"> </span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># mv jenkins.war jenkins.war-bak</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># cp /var/jenkins_home/jenkins.war .</span></span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># ls</span></span><br><span class="line">jenkins.war  jenkins.war-bak</span><br><span class="line"> </span><br><span class="line">somehost$:/usr/share/jenkins<span class="comment"># exit </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#é‡å¯å®¹å™¨</span></span><br><span class="line">docker restart [jenkins contanerID]</span><br></pre></td></tr></table></figure>
<p>ä¹‹åé‡æ–°è®¿é—®jenkinsé¡µé¢å°±ä¼šå‘ç°jenkinsåœ¨å‡†å¤‡å‡çº§,ç¨åå°±ä¼šå®Œæˆå‡çº§, å‡çº§åçš„jenkinsåˆ™ä¼šæç¤º<a href="https://wiki.jenkins.io/display/JENKINS/Security+implication+of+building+on+master">å·²æœ‰é£é™©</a><br><img src="jenkins_doc_security.png" alt="jenkins_doc_security"><br>çœ‹èµ·æ¥å¥½åƒè¯´çš„æ˜¯é€šè¿‡jenkins controllerç›´æ¥è¿è¡Œçš„buildèƒ½ç›´æ¥è¯»å†™<code>$JENKINS_HOME</code>çš„æ–‡ä»¶,ç›¸å½“äºèƒ½è§¦åŠåƒå®‰è£…æ’ä»¶,è¯»å‡­è¯,åˆ›å»ºæ–°jobç­‰å‡ ä¹æ‰€æœ‰æ“ä½œäº†, æ‰€ä»¥è²Œä¼¼æ˜¯å»ºè®®é€šè¿‡å…¶ä»–æœåŠ¡å™¨,æ¥ä»£ç†è·‘æ„å»ºä»»åŠ¡(<code>agent</code>), å¦åˆ™çš„è¯å°±è¦å¥½å¥½æ£€æŸ¥ä¸‹<code>$JENKINS_HOME</code>çš„æƒé™äº†, jenkinsæˆ‘æš‚æ—¶ç”¨ä¸ä¸Š,å…ˆæŒ‰ä¸Šé¢è®¾ç½®æŠŠæ‰§è¡Œå™¨æ”¹æˆé›¶<br><img src="jenkins_node.png" alt="jenkins_node"></p>
<h3 id="æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬"><a href="#æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬" class="headerlink" title="æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬"></a>æ£€æŸ¥å®šæ—¶ä»»åŠ¡è„šæœ¬</h3><p>æ¥ä¸‹æ¥å†æ£€æŸ¥ä¸‹æœåŠ¡å™¨åœ¨è·‘å•¥å®šæ—¶è„šæœ¬</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">crontab -l <span class="comment"># æŸ¥çœ‹</span></span><br><span class="line">crontab -r <span class="comment"># æ¸…ç©º</span></span><br></pre></td></tr></table></figure>
<p><img src="terminal_4.png" alt="terminal_4"></p>
<p>ç¡®å®å‘ç°äº†ä¸ªæˆ‘æ¯«æ— å°è±¡çš„è„šæœ¬, ä¹Ÿæ²¡å¤šæƒ³,ç›´æ¥è¢«æˆ‘<code>crontab -r</code>äº†, ä¸€å¥—æ“ä½œä¸‹æ¥<code>top</code>å‘½ä»¤æŸ¥çœ‹å, cpuä½¿ç”¨å·²ç„¶æ¢å¤æ­£å¸¸(æœåŠ¡å™¨æ›´æœ¬æ²¡è·‘å•¥,å ç”¨ç‡è¶‹è¿‘äº0äº†), ç½ªé­ç¥¸é¦–traceä¹Ÿä¸å†å¤æ´», ä¹Ÿç®—æ˜¯ã€Œä¸€ä»¶è½ç€/ã„ã£ã‘ã‚“ã‚‰ãã¡ã‚ƒãã€</p>
<h3 id="ç»ˆå±€"><a href="#ç»ˆå±€" class="headerlink" title="ç»ˆå±€"></a>ç»ˆå±€</h3><p>è§£å†³åå›åˆ°æœ¬åœ°sshç™»å½•æœåŠ¡å™¨,å‘ç°ä»æ˜¯</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">root@xxx.xx.xx.xxx<span class="string">&#x27;s password: </span></span><br><span class="line"><span class="string">Permission denied, please try again.</span></span><br><span class="line"><span class="string">root@xxx.xx.xx.xxx&#x27;</span>s password: </span><br><span class="line">root@xxx.xx.xx.xxx: Permission denied (publickey,gssapi-keyex,gssapi-with-mic,pa</span><br><span class="line">ssword)</span><br></pre></td></tr></table></figure>
<p>fuck sake,è¿™å°±å¤ªä»¤äººå¥‡æ€ªå•¦,å‚è€ƒç½‘ä¸Šä¿®æ”¹ <code>/etc/ssh/ssh_config</code> å¼€å¯å¯†ç éªŒè¯, rootç”¨æˆ·ç™»å½•ç­‰é€‰é¡¹é‡å¯sshæœåŠ¡å•¥çš„éƒ½è¯•äº†ä¸€é, è¿˜æ˜¯ä¸ç®¡ç”¨, æœ€åçš„æœ€åå‘ç°ä»æœ€å¼€å§‹æœ¬åœ°ç™»å½•æ—¶çš„å…¬ç½‘ipå°±æ‰“é”™äº†ä¸€ä½, çœŸçš„æ˜¯çŸ¥é“ç»“å±€çš„æˆ‘çœ¼æ³ªè½ä¸‹æ¥, æ®‹å¿µ</p>
<h3 id="æ”¶å°¾"><a href="#æ”¶å°¾" class="headerlink" title="æ”¶å°¾"></a>æ”¶å°¾</h3><p>ç™»å½•ä¸ŠæœåŠ¡å™¨å°±å¥½è¯´äº†, æŠŠä¹‹å‰çš„é™æ€æ–‡ä»¶ä¸Šä¼ ä¸Šå»å°±å¥½, çœ‹ç€è‡ªå·±æœ€æœ€å¼€å§‹å†™çš„é¡µé¢çœŸæ˜¯æ„Ÿæ…¨ä¸‡åƒ, ä»¿ä½›å½“æ—¶çš„æƒ…æ„Ÿåˆæ¶Œä¸Šå¿ƒå¤´, å¯ç°åœ¨çš„è‡ªå·±åˆæœ‰å¤šå°‘æˆé•¿å‘¢, æ˜¯å¦åˆå¤±å»äº†å¤§æŠŠå¯èƒ½æ€§, å˜å¾—è¶Šæ¥è¶Šæ— è¶£äº†å‘¢. </p>
<p>ps. æœåŠ¡å™¨åŸŸåä¼°è®¡ä»Šå¹´ä¸­æ—¬å°±åˆ°æœŸäº†,å§‘ä¸”å…ˆæ”¾ç€å‡ å¤©å§, <a href="https://www.mimimimimi.top/">www.mimimimimi.top</a>, è¿™æ¸¸æˆæ˜¯æˆ‘å¤§å­¦è¦æ¯•ä¸šæ—¶ç©å„¿çš„, å½“æ—¶è®°å¾—é€šå…³ä¸€å‘¨ç›®æ™®é€šæ¨¡å¼æ­»äº†300å¤šæ¬¡, åƒç´ æ¸¸æˆå°è€Œç²¾ç¾,å¾ˆæœ‰æ—ºè¾¾ä¸å·¨åƒçš„å‘³é“, é‚£å‡ å¤©ä¸‹æ¥è„‘è¢‹é‡Œéƒ½æ˜¯è¿™æ¬¾æ¸¸æˆ, å“ˆå“ˆ, æ¯•è®¾è¦å†™å•¥,èˆå‹ä»¬éƒ½åœ¨å‘æ„, æˆ‘æƒ³ç€è¦ä¸ç„¶å°±å†™ä¸ªä»‹ç»è¿™ä¸ªæ¸¸æˆçš„â€å°ç½‘ç«™â€å§, è¿™ä¹ˆå¤šå¹´åå®ƒç»ˆäºè¢«æˆ‘å†æ¬¡æƒ³èµ·,æˆåŠŸä¸Šçº¿äº†ğŸ˜ </p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>jenkins</tag>
        <tag>ssh</tag>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>ä½¿ç”¨mapboxåšå¤§å±å±•ç¤º3då»ºç­‘åœ°å›¾</title>
    <url>/2021/05/01/%E4%BD%BF%E7%94%A8mapbox%E5%81%9A%E5%A4%A7%E5%B1%8F%E5%B1%95%E7%A4%BA3d%E5%BB%BA%E7%AD%91%E5%9C%B0%E5%9B%BE/</url>
    <content><![CDATA[<p>ç®€å•è®°å½•ä¸‹ä½¿ç”¨ mapbox å±•ç¤º 3d å»ºç­‘ç‰©åœ°å›¾</p>
<h4 id="ä½¿ç”¨map-studioåˆ¶ä½œçš„æ ·å¼"><a href="#ä½¿ç”¨map-studioåˆ¶ä½œçš„æ ·å¼" class="headerlink" title="ä½¿ç”¨map studioåˆ¶ä½œçš„æ ·å¼"></a>ä½¿ç”¨map studioåˆ¶ä½œçš„æ ·å¼</h4><p><img src="mapbox-studio.png" alt="map studio"></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> mapboxgl.Map(&#123;</span><br><span class="line">  version: <span class="number">8</span>,</span><br><span class="line">  name: <span class="string">&quot;Basic&quot;</span>,</span><br><span class="line">  center: [<span class="number">120.31463022979744</span>, <span class="number">36.06658532033572</span>],</span><br><span class="line">  <span class="comment">// center: [116.89909930420157, 36.666567085091614],</span></span><br><span class="line">  zoom: <span class="number">16</span>,</span><br><span class="line">  bearing: <span class="number">11.199999999999818</span>,</span><br><span class="line">  pitch: <span class="number">60</span>,</span><br><span class="line">  sources: &#123;</span><br><span class="line">    composite: &#123;</span><br><span class="line">      url: <span class="string">&quot;mapbox://mapbox.mapbox-streets-v8&quot;</span>,</span><br><span class="line">      type: <span class="string">&quot;vector&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ä½¿ç”¨ mapbox studioåˆ¶ä½œåˆ†äº«çš„æ ·å¼</span></span><br><span class="line">  style: <span class="string">&quot;mapbox://styles/wumi/ckew6c8b60g2s19pij43gk4ft&quot;</span>,</span><br><span class="line">  container: <span class="string">&quot;map&quot;</span>,</span><br><span class="line">  antialias: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3d-buildings"><a href="#3d-buildings" class="headerlink" title="3d-buildings"></a><a href="https://docs.mapbox.com/mapbox-gl-js/example/3d-buildings/">3d-buildings</a></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> layers = map.getStyle().layers</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> labelLayerId</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; layers.length; i++) &#123;</span><br><span class="line">       <span class="keyword">if</span> (layers[i].type === <span class="string">&#x27;symbol&#x27;</span> &amp;&amp; layers[i].layout[<span class="string">&#x27;text-field&#x27;</span>]) &#123;</span><br><span class="line">         labelLayerId = layers[i].id</span><br><span class="line">         <span class="keyword">break</span></span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment">// layer 3d buliding</span></span><br><span class="line">     map.addLayer(</span><br><span class="line">       &#123;</span><br><span class="line">         id: <span class="string">&#x27;3d-buildings&#x27;</span>,</span><br><span class="line">         source: <span class="string">&#x27;composite&#x27;</span>,</span><br><span class="line">         <span class="string">&#x27;source-layer&#x27;</span>: <span class="string">&#x27;building&#x27;</span>,</span><br><span class="line">         filter: [<span class="string">&#x27;==&#x27;</span>, <span class="string">&#x27;extrude&#x27;</span>, <span class="string">&#x27;true&#x27;</span>],</span><br><span class="line">         type: <span class="string">&#x27;fill-extrusion&#x27;</span>,</span><br><span class="line">         minzoom: <span class="number">15</span>,</span><br><span class="line">         paint: &#123;</span><br><span class="line">           <span class="string">&#x27;fill-extrusion-color&#x27;</span>: [<span class="string">&#x27;interpolate&#x27;</span>, [<span class="string">&#x27;exponential&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;height&#x27;</span>], <span class="number">0</span>, <span class="string">&#x27;hsl(175, 59%, 51%)&#x27;</span>, <span class="number">50</span>, <span class="string">&#x27;hsl(244, 81%, 46%)&#x27;</span>],</span><br><span class="line"></span><br><span class="line">           <span class="comment">// ä½¿ç”¨â€œæ’å€¼â€è¡¨è¾¾å¼ä¸º</span></span><br><span class="line">           <span class="comment">// å»ºç­‘ç‰©ä½œä¸ºç”¨æˆ·æ”¾å¤§</span></span><br><span class="line">           <span class="string">&#x27;fill-extrusion-height&#x27;</span>: [<span class="string">&#x27;interpolate&#x27;</span>, [<span class="string">&#x27;linear&#x27;</span>], [<span class="string">&#x27;zoom&#x27;</span>], <span class="number">15</span>, <span class="number">0</span>, <span class="number">15.05</span>, [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;height&#x27;</span>]],</span><br><span class="line">           <span class="string">&#x27;fill-extrusion-base&#x27;</span>: [<span class="string">&#x27;interpolate&#x27;</span>, [<span class="string">&#x27;linear&#x27;</span>], [<span class="string">&#x27;zoom&#x27;</span>], <span class="number">15</span>, <span class="number">0</span>, <span class="number">15.05</span>, [<span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;min_height&#x27;</span>]],</span><br><span class="line">           <span class="string">&#x27;fill-extrusion-opacity&#x27;</span>: <span class="number">0.6</span></span><br><span class="line">         &#125;</span><br><span class="line">       &#125;,</span><br><span class="line">       labelLayerId</span><br><span class="line">     )</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ -GeoJSON-å¤šè¾¹å½¢"><a href="#æ·»åŠ -GeoJSON-å¤šè¾¹å½¢" class="headerlink" title="æ·»åŠ  GeoJSON å¤šè¾¹å½¢"></a><a href="https://www.mapbox.cn/mapbox-gl-js/example/geojson-polygon/">æ·»åŠ  GeoJSON å¤šè¾¹å½¢</a></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// layer fill geojson https://www.mapbox.cn/mapbox-gl-js/example/geojson-polygon/</span></span><br><span class="line">map.addLayer(&#123;</span><br><span class="line">  id: <span class="string">&quot;geoPolygon_2&quot;</span>,</span><br><span class="line">  type: <span class="string">&quot;fill&quot;</span>,</span><br><span class="line">  source: &#123;</span><br><span class="line">    type: <span class="string">&quot;geojson&quot;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      type: <span class="string">&quot;Feature&quot;</span>,</span><br><span class="line">      geometry: &#123;</span><br><span class="line">        type: <span class="string">&quot;Polygon&quot;</span>,</span><br><span class="line">        coordinates: [</span><br><span class="line">          [</span><br><span class="line">            [<span class="number">120.31386645128458</span>, <span class="number">36.07352407299466</span>],</span><br><span class="line">            [<span class="number">120.31406051266816</span>, <span class="number">36.06973548187716</span>],</span><br><span class="line">            [<span class="number">120.31703395879913</span>, <span class="number">36.067476673147524</span>],</span><br><span class="line">            [<span class="number">120.31903338030969</span>, <span class="number">36.06914023164856</span>],</span><br><span class="line">            [<span class="number">120.31725031669936</span>, <span class="number">36.072912209593554</span>],</span><br><span class="line">            [<span class="number">120.31386645128458</span>, <span class="number">36.07352407299466</span>],</span><br><span class="line">            <span class="comment">// [116.90015862619504, 36.67485225304701],</span></span><br><span class="line">            <span class="comment">// [116.89925746159167, 36.66643736142822],</span></span><br><span class="line">            <span class="comment">// [116.90449322417288, 36.66646071375989],</span></span><br><span class="line">            <span class="comment">// [116.90474640425532, 36.674772049527036],</span></span><br><span class="line">            <span class="comment">// [116.90015862619504, 36.67485225304701]</span></span><br><span class="line">          ],</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  layout: &#123;&#125;,</span><br><span class="line">  paint: &#123;</span><br><span class="line">    <span class="string">&quot;fill-color&quot;</span>: <span class="string">&quot;#0becff&quot;</span>,</span><br><span class="line">    <span class="string">&quot;fill-opacity&quot;</span>: <span class="number">0.5</span>,</span><br><span class="line">    <span class="string">&quot;fill-outline-color&quot;</span>: <span class="string">&quot;#15def2&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="æ·»åŠ å¼¹å±‚"><a href="#æ·»åŠ å¼¹å±‚" class="headerlink" title="æ·»åŠ å¼¹å±‚"></a><a href="https://www.mapbox.cn/mapbox-gl-js/api/#popup">æ·»åŠ å¼¹å±‚</a></h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// add marker popup</span></span><br><span class="line">      <span class="keyword">var</span> popup = <span class="keyword">new</span> mapboxgl.Popup(&#123;</span><br><span class="line">        offset: [<span class="number">180</span>, -<span class="number">20</span>],</span><br><span class="line">        className: <span class="string">&#x27;IBM_popup&#x27;</span>,</span><br><span class="line">        maxWidth: <span class="string">&#x27;none&#x27;</span></span><br><span class="line">      &#125;).setText(<span class="string">&#x27;æŸæŸç«™&#x27;</span>)</span><br><span class="line">      <span class="comment">// create DOM element for the marker</span></span><br><span class="line">      <span class="keyword">var</span> el = <span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">      el.innerHTML = <span class="string">&#x27;&lt;span&gt;ç‚¹ä½&lt;/span&gt;&#x27;</span></span><br><span class="line">      el.id = <span class="string">&#x27;marker&#x27;</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// create the marker</span></span><br><span class="line">      <span class="keyword">new</span> mapboxgl.Marker(el)</span><br><span class="line">        .setLngLat([<span class="number">120.31319853001287</span>, <span class="number">36.069633414671344</span>])</span><br><span class="line">        <span class="comment">// .setLngLat([116.89759274743653, 36.66859665993769])</span></span><br><span class="line">        .setPopup(popup) <span class="comment">// sets a popup on this marker</span></span><br><span class="line">        .addTo(map)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="æœ€åæ•ˆæœ"><a href="#æœ€åæ•ˆæœ" class="headerlink" title="æœ€åæ•ˆæœ"></a>æœ€åæ•ˆæœ</h4><p><img src="mapbox1.png" alt="map1"><br><img src="mapbox2.png" alt="map1"><br><img src="mapbox3.png" alt="map1"></p>
<p><a href="https://zhuanlan.zhihu.com/p/65248694">Mapbox Studio</a></p>
<p>å…ˆæŒ–ä¸ªå‘ ğŸ˜‚ <a href="https://gitee.com/workthing/ruoyuan">demoåœ°å€</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>å·¥ä½œä¸­</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸è§é¢è¯•ç®—æ³•</title>
    <url>/2021/08/26/%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<h2 id="ç®€å•ç®—æ³•"><a href="#ç®€å•ç®—æ³•" class="headerlink" title="ç®€å•ç®—æ³•"></a>ç®€å•ç®—æ³•</h2><h3 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h3><ul>
<li><p><a href="https://leetcode-cn.com/problems/reverse-linked-list/">åè½¬é“¾è¡¨</a></p>
<details>
<summary>å±•å¼€æŸ¥çœ‹</summary>
  <pre>
  <code>
   var reverseList = function(head) &#123;
    if (!head) return null;
    let pre = null, cur = head;
    while (cur) &#123;
        // å…³é”®: ä¿å­˜ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼
        let next = cur.next;
        cur.next = pre;
        pre = cur;
        cur = next;
    &#125;
    return pre;
  &#125;;
  </code>
  </pre>
</details></li>
</ul>
<ul>
<li><p><a href="https://leetcode-cn.com/problems/palindrome-linked-list/">é“¾è¡¨å›æ–‡</a></p>
</li>
<li><p>åˆå¹¶ä¸¤ä¸ªå‡åºé“¾è¡¨</p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/merge-k-sorted-lists/">åˆå¹¶kä¸ªå‡åºé“¾è¡¨</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/reverse-nodes-in-k-group/">K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/linked-list-cycle/">ç¯å½¢é“¾è¡¨</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/sort-list/">é“¾è¡¨æ’åº</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/intersection-of-two-linked-lists/">é“¾è¡¨ç›¸äº¤</a></p>
</li>
<li><p>é“¾è¡¨å€’æ•°ç¬¬ké¡¹å€¼ (åŒæŒ‡é’ˆ,æ…¢æŒ‡é’ˆç­‰å¾…kæ­¥)</p>
</li>
</ul>
<h3 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h3><ul>
<li><p><a href="https://leetcode-cn.com/problems/longest-palindromic-substring/">æœ€é•¿å›æ–‡å­ä¸²</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/longest-common-prefix/">æœ€é•¿å…¬å…±å‰ç¼€</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/longest-substring-without-repeating-characters/">æœ€é•¿æ— é‡å¤å­—ç¬¦ä¸²</a></p>
</li>
</ul>
<h3 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h3><ul>
<li><p><a href="https://leetcode-cn.com/problems/longest-continuous-increasing-subsequence/">æœ€é•¿è¿ç»­é€’å¢åºåˆ—</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/remove-duplicates-from-sorted-array/">åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/container-with-most-water/">ç››æœ€å¤šæ°´çš„å®¹å™¨</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/two-sum/submissions/">ä¸¤æ•°ä¹‹å’Œ</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/two-sum-ii-input-array-is-sorted/">ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></p>
</li>
</ul>
<h3 id="äºŒå‰æ ‘"><a href="#äºŒå‰æ ‘" class="headerlink" title="äºŒå‰æ ‘"></a>äºŒå‰æ ‘</h3><ul>
<li><p>æ·±åº¦ä¼˜å…ˆéå† (å‰åº,ä¸­åº,ååº)</p>
</li>
<li><p>å¹¿åº¦ä¼˜å…ˆéå† (å±‚åº)</p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/maximum-depth-of-binary-tree/">äºŒå‰æ ‘æœ€å¤§æ·±åº¦</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/minimum-depth-of-binary-tree/">äºŒå‰æ ‘çš„æœ€å°æ·±åº¦</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/convert-sorted-array-to-binary-search-tree/">å°†æœ‰åºæ•°ç»„è½¬æ¢ä¸ºäºŒå‰æœç´¢æ ‘</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/validate-binary-search-tree/">éªŒè¯äºŒå‰æœç´¢æ ‘</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/ping-heng-er-cha-shu-lcof/">éªŒè¯å¹³è¡¡äºŒå‰æ ‘</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/lowest-common-ancestor-of-a-binary-tree/">äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/search-in-a-binary-search-tree/">äºŒå‰æœç´¢æ ‘ä¸­çš„æœç´¢</a></p>
</li>
<li><p><a href="https://leetcode-cn.com/problems/binary-tree-zigzag-level-order-traversal/">äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†ã€äºŒå‰æ ‘ã€‘</a></p>
</li>
</ul>
<p><a href="https://leetcode-cn.com/leetbook/read/top-interview-questions-easy/x26epd/">Leetcode åˆçº§ç®—æ³•</a></p>
<p><a href="http://47.98.159.95/leetcode-js/nav/">å‰ç«¯ç®—æ³•ç»ƒä¹ æŒ‡å—</a></p>
<p><a href="https://juejin.cn/post/6947842412102287373">å­—èŠ‚è·³åŠ¨æœ€çˆ±è€ƒçš„ 64 é“ç®—æ³•é¢˜</a></p>
<p>æœªæ¥å†æ›´â€¦</p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>é¢è¯•</tag>
      </tags>
  </entry>
  <entry>
    <title>IOCä¸DI,Decorator,reflect Matedata</title>
    <url>/2021/10/10/IOC%E4%B8%8EDI-reflect-Matedata/</url>
    <content><![CDATA[<blockquote>
<p>å†…å®¹æ¥è‡ªäº’è”ç½‘, ä»…ç”¨äºä¸ªäººå­¦ä¹ è®°å¿†</p>
</blockquote>
<h3 id="IoC"><a href="#IoC" class="headerlink" title="IoC"></a>IoC</h3><p>IoCï¼ˆInversion of Controlï¼‰æ§åˆ¶åè½¬,æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œç”¨æ¥é™ä½è®¡ç®—æœºä»£ç ä¹‹é—´çš„è€¦åˆåº¦</p>
<blockquote>
<p>åœ¨ä¼ ç»Ÿé¢å‘å¯¹è±¡çš„ç¼–ç è¿‡ç¨‹ä¸­ï¼Œå½“ç±»ä¸ç±»ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œé€šå¸¸ä¼šç›´æ¥åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œè¿™æ ·å°±å¯¼è‡´ç±»ä¸ç±»ä¹‹é—´å½¢æˆäº†è€¦åˆï¼Œä¾èµ–å…³ç³»è¶Šå¤æ‚ï¼Œè€¦åˆç¨‹åº¦å°±ä¼šè¶Šé«˜ï¼Œè€Œè€¦åˆåº¦é«˜çš„ä»£ç ä¼šéå¸¸éš¾ä»¥è¿›è¡Œä¿®æ”¹å’Œå•å…ƒæµ‹è¯•ã€‚è€Œ IoC åˆ™æ˜¯ä¸“é—¨æä¾›ä¸€ä¸ªå®¹å™¨è¿›è¡Œä¾èµ–å¯¹è±¡çš„åˆ›å»ºå’ŒæŸ¥æ‰¾ï¼Œå°†å¯¹ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒç”±ç±»å†…éƒ¨äº¤åˆ°å®¹å™¨è¿™é‡Œï¼Œè¿™æ ·å°±å®ç°äº†ç±»ä¸ç±»çš„è§£è€¦ï¼Œä¿è¯æ‰€æœ‰çš„ç±»éƒ½æ˜¯å¯ä»¥çµæ´»ä¿®æ”¹</p>
</blockquote>
<h4 id="è€¦åˆ"><a href="#è€¦åˆ" class="headerlink" title="è€¦åˆ"></a>è€¦åˆ</h4><p>åœ¨ä¸ä½¿ç”¨ IoC çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“å†™å‡ºæ¥è¿™æ ·çš„ä»£ç ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// modB.ts</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  p: <span class="built_in">number</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">p</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.p = p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; A &#125; <span class="keyword">from</span> <span class="string">&quot;./modA&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; B &#125; <span class="keyword">from</span> <span class="string">&quot;./modB&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  a: A;</span><br><span class="line">  b: B;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = <span class="keyword">new</span> A();</span><br><span class="line">    <span class="built_in">this</span>.b = <span class="keyword">new</span> B(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹åˆ°<code>C</code>ç±»éœ€è¦ä¾èµ–<code>A</code>,<code>B</code>ç±» ä¸å…¶è€¦åˆ, å½“éšç€é¡¹ç›®çš„è¿­ä»£, ä¾èµ–å…³ç³»å‘ç”Ÿå˜åŒ–,æˆ–ä¾èµ–é¡¹<code>A</code>,<code>B</code>åˆå§‹åŒ–å‚æ•°å˜åŒ–æ—¶, è¿™ç§ä¾èµ–å…³ç³»å°†å˜å¾—éš¾ä»¥ç»´æŠ¤</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; A &#125; <span class="keyword">from</span> <span class="string">&quot;./modA&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; B &#125; <span class="keyword">from</span> <span class="string">&quot;./modB&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  a: A;</span><br><span class="line">  b: B;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">a, b</span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.a = a;</span><br><span class="line">    <span class="built_in">this</span>.b = b;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B(<span class="string">&quot;what ever&quot;</span>);</span><br><span class="line"><span class="keyword">let</span> c = <span class="keyword">new</span> C(a, b);</span><br></pre></td></tr></table></figure>

<p>å®é™…ä¸Šå¯¹äº<code>C</code>ç±»å‹å®ä¾‹åŒ–è€Œè¨€,å¹¶ä¸åœ¨ä¹<code>B</code>å®ä¾‹åŒ–çš„å‚æ•°, ç¨åŠ ä¿®æ”¹åªéœ€è¦é€šè¿‡<code>A</code>,<code>B</code>çš„å®ä¾‹å°±å¯è¿›è¡Œæ„é€ , è¿™æ ·å°±èƒ½ä½“ç°å‡ºç±»ä¸ç±»ä¹‹é—´çš„è§£è€¦</p>
<h4 id="å®¹å™¨"><a href="#å®¹å™¨" class="headerlink" title="å®¹å™¨"></a>å®¹å™¨</h4><blockquote>
<p>è™½ç„¶æˆ‘ä»¬å®ç°äº†è§£è€¦ï¼Œä½†æˆ‘ä»¬ä»éœ€è¦è‡ªå·±åˆå§‹åŒ–æ‰€æœ‰çš„ç±»ï¼Œå¹¶ä»¥æ„é€ å‡½æ•°å‚æ•°çš„å½¢å¼è¿›è¡Œä¼ é€’ã€‚å¦‚æœå­˜åœ¨ä¸€ä¸ªå…¨å±€çš„å®¹å™¨ï¼Œé‡Œé¢é¢„å…ˆæ³¨å†Œå¥½äº†æˆ‘ä»¬æ‰€éœ€å¯¹è±¡çš„ç±»å®šä¹‰ä»¥åŠåˆå§‹åŒ–å‚æ•°ï¼Œæ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„ keyã€‚é‚£ä¹ˆå½“æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸä¸ªå¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å‘Šè¯‰å®¹å™¨å®ƒå¯¹åº”çš„ keyï¼Œå°±å¯ä»¥ç›´æ¥ä»å®¹å™¨ä¸­å–å‡ºå®ä¾‹åŒ–å¥½çš„å¯¹è±¡ï¼Œå¼€å‘è€…å°±ä¸ç”¨å†å…³å¿ƒå¯¹è±¡çš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œä¹Ÿä¸éœ€è¦å°†ä¾èµ–å¯¹è±¡ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°åœ¨ä¾èµ–é“¾è·¯ä¸Šä¼ é€’, ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬çš„å®¹å™¨å¿…é¡»å…·ä½“ä¸¤ä¸ªåŠŸèƒ½ï¼Œ<strong>å®ä¾‹çš„æ³¨å†Œå’Œè·å–</strong></p>
</blockquote>
<p>å³æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªå®¹å™¨,ç»´æŠ¤æœªæ¥éœ€è¦ä½¿ç”¨çš„ç±»åŠå…¶å¯¹ç…§å…³ç³»,å½“éœ€è¦å…·ä½“ç±»å‹çš„å®ä¾‹æ—¶, é€šè¿‡å¯¹ç…§å…³ç³»å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„ç±», å¹¶åœ¨å®¹å™¨ä¸­ç›´æ¥åˆå§‹åŒ–</p>
<blockquote>
<p>å†ä¸¾ä¸ªæ —å­ï¼Œå½“æˆ‘ä»¬æƒ³è¦å¤„å¯¹è±¡æ—¶ï¼Œä¼šä¸Š Soulã€Summerã€é™Œé™Œâ€¦ç­‰ç­‰å»ä¸€ä¸ªä¸ªæ‰¾ï¼Œæ‰¾å“ªç§çš„ä¸æ€ä¹ˆæ‰¾æ˜¯ç”±æˆ‘è‡ªå·±å†³å®šçš„ï¼Œè¿™å« <strong>æ§åˆ¶æ­£è½¬</strong>ã€‚ç°åœ¨æˆ‘è§‰å¾—æœ‰ç‚¹éº»çƒ¦ï¼Œç›´æ¥æŠŠè‡ªå·±çš„ä»‹ç»ä¸Šä¼ åˆ°ä¸–çºªä½³ç¼˜ï¼Œå¦‚æœæœ‰äººçœ‹ä¸Šæˆ‘äº†ï¼Œå°±ä¼šä¸»åŠ¨å‘æˆ‘å‘èµ·èŠå¤©ï¼Œè¿™å« <strong>æ§åˆ¶åè½¬</strong></p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; A &#125; <span class="keyword">from</span> <span class="string">&quot;./modA&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; B &#125; <span class="keyword">from</span> <span class="string">&quot;./modB&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  a: A;</span><br><span class="line">  b: B;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨ä»å®¹å™¨ä¸­è·å–å®ä¾‹</span></span><br><span class="line">    <span class="built_in">this</span>.a = container.get(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.b = container.get(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> container = <span class="keyword">new</span> Container();</span><br><span class="line"><span class="comment">// æ‰‹åŠ¨å‘å®¹å™¨æ³¨å†Œç±»å‹</span></span><br><span class="line">container.bind(<span class="string">&quot;a&quot;</span>, A);</span><br><span class="line">container.bind(<span class="string">&quot;b&quot;</span>, B, [<span class="string">&quot;what ever&quot;</span>]);</span><br><span class="line">container.bind(<span class="string">&quot;c&quot;</span>, C);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä»å®¹å™¨ä¸­å–å‡ºc</span></span><br><span class="line"><span class="keyword">const</span> c = container.get(<span class="string">&quot;c&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>åˆ°æ­¤ä¸ºæ­¢, è™½ç„¶å®¹å™¨å®Œæˆäº†ç±»ä¸ç±»çš„è§£è€¦, ä½†å®¹å™¨çš„åˆå§‹åŒ–åŠå„ç±»å‹çš„æ³¨å†Œçœ‹ä¸Šå»è¿˜æ˜¯å¾ˆç¹ççš„, å¦‚æœè¿™éƒ¨åˆ†å¯ä»¥é€šè¿‡å°è£…è¿›æ¡†æ¶è‡ªåŠ¨è¿›è¡Œ, å¹¶ä¸”åœ¨ç±»å®ä¾‹åŒ–æ—¶æ— éœ€æ‰‹åŠ¨æŒ‡å®š, è€Œå¯ä»¥ç›´æ¥è‡ªåŠ¨æ‹¿åˆ°æ‰€éœ€å®ä¾‹, è¿™æ ·å°±å¯ä»¥æ›´ä¸“æ³¨äºå†…éƒ¨é€»è¾‘çš„å¼€å‘, åŠå®ç°ä¾èµ–æ³¨å…¥</p>
<h3 id="DIï¼ˆDependency-Injectionï¼‰ä¾èµ–æ³¨å…¥"><a href="#DIï¼ˆDependency-Injectionï¼‰ä¾èµ–æ³¨å…¥" class="headerlink" title="DIï¼ˆDependency Injectionï¼‰ä¾èµ–æ³¨å…¥"></a>DIï¼ˆDependency Injectionï¼‰ä¾èµ–æ³¨å…¥</h3><p>IoC æ˜¯ä¸€ç§æ€æƒ³, è€Œ DI æ˜¯å…¶ä¸€ç§æŠ€æœ¯å®ç°, å³å°†ä¾èµ–æ³¨å…¥ç»™è°ƒç”¨æ–¹,è€Œæ— éœ€è°ƒç”¨å‘ä¸»åŠ¨è·å–, éœ€è¦è§£å†³ä¸€ä¸‹é—®é¢˜</p>
<ul>
<li>ç¨‹åºå¯åŠ¨æ—¶,æ‰€æœ‰ç±»å‹ä¼šåœ¨å®¹å™¨ä¸­è‡ªåŠ¨æ³¨å†Œ</li>
<li>å®ä¾‹åŒ–æ—¶ç±»å‹æ‰€éœ€çš„å¯¹è±¡çš„è‡ªåŠ¨æ³¨å…¥, æ— éœ€åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®š</li>
</ul>
<p>è€Œè¿™äº›å³å¯é€šè¿‡ <code>TSè£…é¥°å™¨</code> ç»“åˆ <code>Reflect Metadata</code>å®ç°</p>
<h4 id="TS-Decorator"><a href="#TS-Decorator" class="headerlink" title="TS Decorator"></a>TS Decorator</h4><blockquote>
<p>é¦–å…ˆåœ¨<code>tsconfig.json</code>ä¸­è®¾ç½®<code>experimentalDecorators</code>ä¸<code>emitDecoratorMetadata</code>ä¸º<code>true</code></p>
</blockquote>
<h5 id="ç±»è£…é¥°å™¨"><a href="#ç±»è£…é¥°å™¨" class="headerlink" title="ç±»è£…é¥°å™¨"></a>ç±»è£…é¥°å™¨</h5><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addProp</span>(<span class="params">constructor: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">  <span class="title">constructor</span>.<span class="title">prototype</span>.<span class="title">sayhi</span> = &quot;<span class="title">hi</span>&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@addProp</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">P</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p = <span class="keyword">new</span> P();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(p.sayhi); <span class="comment">// hi</span></span><br></pre></td></tr></table></figure>

<p>å¯¹äºç±»è£…é¥°å™¨æ¥è¯´ å…¥å‚ä¸º æ­¤ Class å³ <strong>æ„é€ å‡½æ•°</strong></p>
<h5 id="æ–¹æ³•è£…é¥°å™¨"><a href="#æ–¹æ³•è£…é¥°å™¨" class="headerlink" title="æ–¹æ³•è£…é¥°å™¨"></a>æ–¹æ³•è£…é¥°å™¨</h5><p>æ–¹æ³•è£…é¥°å™¨çš„å…¥å‚ä¸º <strong>ç±»çš„åŸå‹å¯¹è±¡</strong> <strong>å±æ€§å</strong> ä»¥åŠ **å±æ€§æè¿°ç¬¦(descriptor)**ï¼Œå…¶å±æ€§æè¿°ç¬¦åŒ…å«<code>writable</code> <code>enumerable</code> <code>configurable</code> <code>value</code> ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œå»é…ç½®å…¶ç›¸å…³ä¿¡æ¯ ç±»ä¼¼<code>Object.defineProperty()</code></p>
<blockquote>
<ol>
<li>Either the constructor function of the class for a static member, or the prototype of the class for an instance member.</li>
<li>The name of the member.</li>
<li>The Property Descriptor for the member.</li>
</ol>
</blockquote>
<blockquote>
<p>æ³¨æ„ï¼Œå¯¹äºé™æ€æˆå‘˜æ¥è¯´ï¼Œé¦–ä¸ªå‚æ•°ä¼šæ˜¯ç±»çš„æ„é€ å‡½æ•°ã€‚è€Œå¯¹äºå®ä¾‹æˆå‘˜ï¼ˆæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼‰ï¼Œåˆ™æ˜¯ç±»çš„åŸå‹å¯¹è±¡</p>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addProps</span>(<span class="params"></span>): <span class="title">MethodDecorator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">target, propertyKey, descriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// A.prototype</span></span><br><span class="line">    <span class="built_in">console</span>.log(target);</span><br><span class="line">    <span class="built_in">console</span>.log(propertyKey);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(descriptor));</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="meta">@addProps</span>()</span><br><span class="line">  <span class="function"><span class="title">sayhi</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;hi~&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å±æ€§è£…é¥°å™¨"><a href="#å±æ€§è£…é¥°å™¨" class="headerlink" title="å±æ€§è£…é¥°å™¨"></a>å±æ€§è£…é¥°å™¨</h5><p>ç±»ä¼¼äºæ–¹æ³•è£…é¥°å™¨ï¼Œä½†å®ƒçš„å…¥å‚å°‘äº†å±æ€§æè¿°ç¬¦ã€‚åŸå› åˆ™æ˜¯ç›®å‰æ²¡æœ‰æ–¹æ³•åœ¨å®šä¹‰åŸå‹å¯¹è±¡æˆå‘˜åŒæ—¶å»æè¿°ä¸€ä¸ªå®ä¾‹çš„å±æ€§ï¼ˆåˆ›å»ºæè¿°ç¬¦ï¼‰ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addProp</span>(<span class="params">target, propertyKey</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// A.prototype</span></span><br><span class="line">  <span class="built_in">console</span>.log(target);</span><br><span class="line">  <span class="comment">// è£…é¥°çš„å±æ€§</span></span><br><span class="line">  <span class="built_in">console</span>.log(propertyKey);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">  <span class="meta">@addProp</span></span><br><span class="line">  <span class="keyword">public</span> name: <span class="built_in">string</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="å‚æ•°è£…é¥°å™¨"><a href="#å‚æ•°è£…é¥°å™¨" class="headerlink" title="å‚æ•°è£…é¥°å™¨"></a>å‚æ•°è£…é¥°å™¨</h5><p>å‚æ•°è£…é¥°å™¨çš„å…¥å‚é¦–è¦ä¸¤ä½ä¸å±æ€§è£…é¥°å™¨ç›¸åŒï¼Œç¬¬ä¸‰ä¸ªå‚æ•°åˆ™æ˜¯å‚æ•°åœ¨å½“å‰å‡½æ•°å‚æ•°ä¸­çš„<strong>ç´¢å¼•</strong></p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">paramDeco</span>(<span class="params">params?: <span class="built_in">any</span></span>): <span class="title">ParameterDecorator</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">target, propertyKey, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(target);</span><br><span class="line">    <span class="built_in">console</span>.log(propertyKey);</span><br><span class="line">    <span class="built_in">console</span>.log(index);</span><br><span class="line">    target.constructor.prototype.fromParamDeco = <span class="string">&quot;å‘€å‘¼ï¼&quot;</span>;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">someMethod</span>(<span class="params"><span class="meta">@paramDeco</span>() param: <span class="built_in">any</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;param&#125;</span>`</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> B().someMethod(<span class="string">&quot;okok&quot;</span>);</span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="built_in">console</span>.log(B.prototype.fromParamDeco);</span><br></pre></td></tr></table></figure>

<h5 id="å¤šä¸ªè£…é¥°å™¨å£°æ˜"><a href="#å¤šä¸ªè£…é¥°å™¨å£°æ˜" class="headerlink" title="å¤šä¸ªè£…é¥°å™¨å£°æ˜"></a>å¤šä¸ªè£…é¥°å™¨å£°æ˜</h5><blockquote>
<p>As such, the following steps are performed when evaluating multiple decorators on a single declaration in TypeScript:</p>
<ol>
<li> The expressions for each decorator are evaluated top-to-bottom.</li>
<li> The results are then called as functions from bottom-to-top.</li>
</ol>
</blockquote>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">first</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;first(): factory evaluated&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    target: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    propertyKey: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    descriptor: PropertyDescriptor</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;first(): called&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">second</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;second(): factory evaluated&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">    target: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    propertyKey: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    descriptor: PropertyDescriptor</span></span></span><br><span class="line"><span class="function"><span class="params">  </span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;second(): called&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExampleClass</span> </span>&#123;</span><br><span class="line">  <span class="meta">@first</span>()</span><br><span class="line">  <span class="meta">@second</span>()</span><br><span class="line">  <span class="function"><span class="title">method</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Which would print this output to the console:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line">first(): factory evaluated</span><br><span class="line">second(): factory evaluated</span><br><span class="line">second(): called</span><br><span class="line">first(): called</span><br></pre></td></tr></table></figure>

<blockquote>
<p>There is a well defined order to how decorators applied to various declarations inside of a class are applied:</p>
<ol>
<li> Parameter Decorators(å‚æ•°è£…é¥°å™¨), followed by Method(æ–¹æ³•è£…é¥°å™¨), Accessor(å¦‚å±æ€§ getter è®¿é—®ç¬¦è£…é¥°å™¨), or Property Decorators(å±æ€§è£…é¥°å™¨) are applied for each instance member.</li>
<li> Parameter Decorators, followed by Method, Accessor, or Property Decorators are applied for each static member.</li>
<li> Parameter Decorators are applied for the constructor.</li>
<li> Class Decorators are applied for the class.</li>
</ol>
</blockquote>
<h4 id="Reflect-Metadata"><a href="#Reflect-Metadata" class="headerlink" title="Reflect Metadata"></a>Reflect Metadata</h4><p>Reflect Metadata æ˜¯å±äº ES7 çš„ä¸€ä¸ªææ¡ˆï¼Œå…¶ä¸»è¦ä½œç”¨æ˜¯åœ¨å£°æ˜æ—¶å»è¯»å†™å…ƒæ•°æ®</p>
<p>ä¸ºç±»æˆ–ç±»å±æ€§æ·»åŠ äº†å…ƒæ•°æ®åï¼Œæ„é€ å‡½æ•°çš„åŸå‹ï¼ˆæˆ–æ˜¯æ„é€ å‡½æ•°ï¼Œæ ¹æ®é™æ€æˆå‘˜è¿˜æ˜¯å®ä¾‹æˆå‘˜å†³å®šï¼‰ä¼šå…·æœ‰<code>[[Metadata]]</code>å±æ€§ï¼Œè¯¥å±æ€§å†…éƒ¨åŒ…å«ä¸€ä¸ª<code>Map</code>ç»“æ„ï¼Œé”®ä¸ºå±æ€§é”®ï¼Œå€¼ä¸ºå…ƒæ•°æ®é”®å€¼å¯¹ã€‚</p>
<h5 id="metadata-æ–¹æ³•"><a href="#metadata-æ–¹æ³•" class="headerlink" title="metadata æ–¹æ³•"></a>metadata æ–¹æ³•</h5><figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">metadataKey</span></span> - å…ƒæ•°æ®å…¥å£çš„key</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param <span class="type">&#123;*&#125;</span> </span>metadataValue å…ƒæ•°æ®å…¥å£çš„value</span></span><br><span class="line"><span class="comment">* <span class="doctag">@returns </span>è£…é¥°å™¨å‡½æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">metadata</span>(<span class="params">metadataKey: <span class="built_in">any</span>, metadataValue: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">    (target: <span class="built_in">Function</span>): <span class="built_in">void</span>;</span><br><span class="line">    (target: <span class="built_in">Object</span>, <span class="attr">propertyKey</span>: <span class="built_in">string</span> | symbol): <span class="built_in">void</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> nameSymbol = <span class="built_in">Symbol</span>(<span class="string">&#x27;veloma&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»å…ƒæ•°æ®</span></span><br><span class="line"><span class="meta">@Reflect</span>.metadata(<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;class&#x27;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaDataClass</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®ä¾‹å±æ€§å…ƒæ•°æ®</span></span><br><span class="line">    <span class="meta">@Reflect</span>.metadata(nameSymbol, <span class="string">&#x27;nihao&#x27;</span>)</span><br><span class="line">    <span class="keyword">public</span> name = <span class="string">&#x27;origin&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ä¾‹æ–¹æ³•å…ƒæ•°æ®</span></span><br><span class="line">    <span class="meta">@Reflect</span>.metadata(<span class="string">&#x27;getName&#x27;</span>, <span class="string">&#x27;getName&#x27;</span>)</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é™æ€æ–¹æ³•å…ƒæ•°æ®</span></span><br><span class="line">    <span class="meta">@Reflect</span>.metadata(<span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;static&#x27;</span>)</span><br><span class="line">    <span class="keyword">static</span> <span class="function"><span class="title">staticMethod</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºå…ƒæ•°æ®ç±»çš„å®ä¾‹</span></span><br><span class="line"><span class="keyword">const</span> metadataInstance = <span class="keyword">new</span> MetaDataClass();</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–MetaDataClassçš„nameå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> value = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;name&#x27;</span>, MetaDataClass); <span class="comment">// undefined</span></span><br><span class="line"><span class="comment">// è·å–å®ä¾‹ä¸­nameå±æ€§çš„nameSymbolå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> name = <span class="built_in">Reflect</span>.getMetadata(nameSymbol, metadataInstance, <span class="string">&#x27;name&#x27;</span>); <span class="comment">// nihao</span></span><br><span class="line"><span class="comment">// è·å–å®ä¾‹ä¸­getNameå±æ€§çš„getNameå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> methodVal = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;getName&#x27;</span>, metadataInstance, <span class="string">&#x27;getName&#x27;</span>); <span class="comment">// getName</span></span><br><span class="line"><span class="comment">// è·å–å…ƒæ•°æ®ç±»çš„staticMethodå±æ€§çš„staticå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> staticVal = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&#x27;static&#x27;</span>, MetaDataClass, <span class="string">&#x27;staticMethod&#x27;</span>); <span class="comment">// static</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(value, name, methodVal, staticVal); <span class="comment">// undefined nihao getName static</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ³¨å…¥åœ¨<strong>é™æ€æˆå‘˜</strong> å¦‚ç±»ä¸ŠåŠé™æ€å±æ€§çš„å…ƒæ•°æ®åœ¨å–å‡ºæ—¶<code>target</code>ä¸ºè¿™ä¸ª<strong>ç±»</strong>ï¼Œè€Œæ³¨å…¥åœ¨<strong>å®ä¾‹æˆå‘˜</strong> å¦‚æ–¹æ³•,å±æ€§ä¸Šçš„å…ƒæ•°æ®åœ¨å–å‡ºæ—¶<code>target</code>åˆ™ä¸º<strong>å®ä¾‹</strong>ã€‚åŸå› å…¶å®æˆ‘ä»¬å®é™…ä¸Šåœ¨ä¸Šé¢çš„è£…é¥°å™¨æ‰§è¡Œé¡ºåºæåˆ°äº†ï¼Œè¿™æ˜¯ç”±äº<strong>æ³¨å…¥åœ¨æ–¹æ³•ã€å±æ€§ã€å‚æ•°ä¸Šçš„å…ƒæ•°æ®å®é™…ä¸Šæ˜¯è¢«æ·»åŠ åœ¨äº†å®ä¾‹å¯¹åº”çš„ä½ç½®ä¸Šï¼Œå› æ­¤éœ€è¦å®ä¾‹åŒ–æ‰èƒ½å–å‡º</strong></p>
<h5 id="defineMetadata-æ–¹æ³•"><a href="#defineMetadata-æ–¹æ³•" class="headerlink" title="defineMetadata æ–¹æ³•"></a>defineMetadata æ–¹æ³•</h5><p>è¯¥æ–¹æ³•æ˜¯<code>metadata</code>çš„å®šä¹‰ç‰ˆæœ¬, ä¹Ÿå°±æ˜¯é<code>@</code>ç‰ˆæœ¬, ä¼šå¤šä¼ ä¸€ä¸ªå‚æ•°<code>target</code>, è¡¨ç¤ºå¾…è£…é¥°çš„å¯¹è±¡</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">metadataKey</span></span> - è®¾ç½®æˆ–è·å–æ—¶çš„key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;*&#125;</span> <span class="variable">metadataValue</span></span> - å…ƒæ•°æ®å†…å®¹</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;Object&#125;</span> <span class="variable">target</span></span> - å¾…è£…é¥°çš„target</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param <span class="type">&#123;string&#125;</span> <span class="variable">targetKey</span></span> - targetçš„property</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineMetadata</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  metadataKey: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  metadataValue: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  target: <span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  targetKey: <span class="built_in">string</span> | symbol</span></span></span><br><span class="line"><span class="function"><span class="params"></span>): <span class="title">void</span></span>;</span><br></pre></td></tr></table></figure>

<p>ç¤ºä¾‹:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DefineMetadata</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> <span class="function"><span class="title">staticMethod</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">  <span class="keyword">static</span> staticProperty = <span class="string">&quot;static&quot;</span>;</span><br><span class="line">  <span class="function"><span class="title">getName</span>(<span class="params"></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">type</span> = <span class="string">&quot;type&quot;</span>;</span><br><span class="line"><span class="comment">// ç»™DefineMetadataè®¾ç½®å…ƒæ•°æ®type, å€¼ä¸ºclass</span></span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(<span class="keyword">type</span>, <span class="string">&quot;class&quot;</span>, DefineMetadata);</span><br><span class="line"><span class="comment">// ç»™DefineMetadata.staticMethodè®¾ç½®å…ƒæ•°æ®type, å€¼ä¸ºstaticMethod</span></span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(<span class="keyword">type</span>, <span class="string">&quot;staticMethod&quot;</span>, DefineMetadata.staticMethod);</span><br><span class="line"><span class="comment">// ç»™DefineMeatadata.prorotype.getNameè®¾ç½®å…ƒæ•°æ®type, å€¼ä¸ºmethod</span></span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(<span class="keyword">type</span>, <span class="string">&quot;method&quot;</span>, DefineMetadata.prorotype.getName);</span><br><span class="line"><span class="comment">// ç»™DefineMetadataçš„staticPropertyå±æ€§è®¾ç½®å…ƒæ•°æ®type, å€¼ä¸ºstaticProperty</span></span><br><span class="line"><span class="built_in">Reflect</span>.defineMetadata(</span><br><span class="line">  <span class="keyword">type</span>,</span><br><span class="line">  <span class="string">&quot;staticProperty&quot;</span>,</span><br><span class="line">  DefineMetadata,</span><br><span class="line">  <span class="string">&quot;staticProperty&quot;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–DefineMetadataèº«ä¸Šçš„typeå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> t1 = <span class="built_in">Reflect</span>.getMetadata(<span class="keyword">type</span>, DefineMetadata); <span class="comment">// class</span></span><br><span class="line"><span class="comment">// è·å–DefineMetadata.staticMethodèº«ä¸Šçš„typeå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> t2 = <span class="built_in">Reflect</span>.getMetadata(<span class="keyword">type</span>, DefineMetadata.staticMethod); <span class="comment">// staticMethod</span></span><br><span class="line"><span class="comment">// è·å–DefineMetadata.prototype.getNameèº«ä¸Šçš„typeå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> t3 = <span class="built_in">Reflect</span>.getMetadata(<span class="keyword">type</span>, DefineMetadata.prototype.getName); <span class="comment">// method</span></span><br><span class="line"><span class="comment">// è·å–DefineMetadataä¸ŠstaticPropertyå±æ€§çš„typeå…ƒæ•°æ®</span></span><br><span class="line"><span class="keyword">const</span> t4 = <span class="built_in">Reflect</span>.getMetadata(<span class="keyword">type</span>, DefineMetadata, <span class="string">&quot;staticProperty&quot;</span>); <span class="comment">// staticProperty</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(t1, t2, t3, t4); <span class="comment">// class staticMethod method staticProperty</span></span><br></pre></td></tr></table></figure>

<p>é¦–å…ˆ npm å®‰è£…</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm i reflect-metadata --save</span><br></pre></td></tr></table></figure>

<p>When enabled, as long as the reflect-metadata library has been imported, additional design-time type information will be exposed at runtime.</p>
<p>We can see this in action in the following example:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params"><span class="keyword">public</span> x: <span class="built_in">number</span>, <span class="keyword">public</span> y: <span class="built_in">number</span></span>)</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Line</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _start: Point;</span><br><span class="line">  <span class="keyword">private</span> _end: Point;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@validate</span></span><br><span class="line">  <span class="keyword">set</span> <span class="title">start</span>(<span class="params">value: Point</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._start = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">start</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._start;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@validate</span></span><br><span class="line">  <span class="keyword">set</span> <span class="title">end</span>(<span class="params">value: Point</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._end = value;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">get</span> <span class="title">end</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._end;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">validate</span>&lt;<span class="title">T</span>&gt;(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  target: <span class="built_in">any</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  propertyKey: <span class="built_in">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  descriptor: TypedPropertyDescriptor&lt;T&gt;</span></span></span><br><span class="line"><span class="function"><span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> set = descriptor.set!;</span><br><span class="line"></span><br><span class="line">  descriptor.set = <span class="function"><span class="keyword">function</span> (<span class="params">value: T</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">type</span> = <span class="built_in">Reflect</span>.getMetadata(<span class="string">&quot;design:type&quot;</span>, target, propertyKey);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!(value <span class="keyword">instanceof</span> <span class="keyword">type</span>)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(</span><br><span class="line">        <span class="string">`Invalid type, got <span class="subst">$&#123;<span class="keyword">typeof</span> value&#125;</span> not <span class="subst">$&#123;<span class="keyword">type</span>.name&#125;</span>.`</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    set.call(<span class="built_in">this</span>, value);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> line = <span class="keyword">new</span> Line();</span><br><span class="line">line.start = <span class="keyword">new</span> Point(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// @ts-ignore</span></span><br><span class="line"><span class="comment">// line.end = &#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Fails at runtime with:</span></span><br><span class="line"><span class="comment">// &gt; Invalid type, got object not Point</span></span><br></pre></td></tr></table></figure>

<p>The TypeScript compiler will inject design-time type information using the @Reflect.metadata decorator. You could consider it the equivalent of the following TypeScript:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Line</span> </span>&#123;</span><br><span class="line">  <span class="keyword">private</span> _start: Point;</span><br><span class="line">  <span class="keyword">private</span> _end: Point;</span><br><span class="line">  <span class="meta">@validate</span></span><br><span class="line">  <span class="meta">@Reflect</span>.metadata(<span class="string">&quot;design:type&quot;</span>, Point)</span><br><span class="line">  <span class="keyword">set</span> <span class="title">start</span>(<span class="params">value: Point</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._start = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">start</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._start;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="meta">@validate</span></span><br><span class="line">  <span class="meta">@Reflect</span>.metadata(<span class="string">&quot;design:type&quot;</span>, Point)</span><br><span class="line">  <span class="keyword">set</span> <span class="title">end</span>(<span class="params">value: Point</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>._end = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">end</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._end;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>design:type</code> å³æ˜¯ TS çš„å†…ç½®å…ƒæ•°æ®ï¼Œä½ å¯ä»¥ç†è§£ä¸º TS åœ¨ç¼–è¯‘å‰è¿˜æ‰‹åŠ¨æ‰§è¡Œäº†<code>@Reflect.metadata(&quot;design:type&quot;, Point)</code>ã€‚TS è¿˜å†…ç½®äº† <strong><code>design:paramtypes</code>ï¼ˆè·å–ç›®æ ‡å‚æ•°ç±»å‹ï¼‰ä¸<code>design:returntype</code>ï¼ˆè·å–æ–¹æ³•è¿”å›å€¼ç±»å‹ï¼‰</strong> è¿™ä¸¤ç§å…ƒæ•°æ®å­—æ®µæ¥æä¾›å¸®åŠ©ã€‚ä½†æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œå³ä½¿å¯¹äºåŸºæœ¬ç±»å‹ï¼Œè¿™äº›å…ƒæ•°æ®ä¹Ÿè¿”å›å¯¹åº”çš„åŒ…è£…ç±»å‹ï¼Œå¦‚<code>number -&gt; [Function: Number]</code></p>
<h3 id="DI-Provider"><a href="#DI-Provider" class="headerlink" title="DI Provider"></a>DI Provider</h3><p>å›åˆ°æˆ‘ä»¬åˆšåˆšæåˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨å¯¹æ‰€æœ‰ç±»è¿›è¡Œå®šä¹‰å’Œå‚æ•°çš„æ³¨å†Œï¼Œé—®é¢˜æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½éœ€è¦æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šå“ªäº›ç±»éœ€è¦æ³¨å†Œçš„ï¼ŒåŒæ—¶ä¹Ÿä¸æ¸…æ¥šéœ€è¦æ³¨å†Œçš„ç±»ï¼Œå®ƒçš„åˆå§‹åŒ–å‚æ•°æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<p>è¿™é‡Œå°±å¯ä»¥å¼•å…¥å…ƒæ•°æ®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåªè¦åœ¨å®šä¹‰çš„æ—¶å€™ä¸ºè¿™ä¸ªç±»çš„å…ƒæ•°æ®æ·»åŠ ç‰¹æ®Šçš„æ ‡è®°ï¼Œå°±å¯ä»¥åœ¨æ‰«æçš„æ—¶å€™è¯†åˆ«å‡ºæ¥ã€‚æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬å…ˆæ¥å®ç°ä¸€ä¸ªè£…é¥°å™¨æ ‡è®°éœ€è¦æ³¨å†Œçš„ç±»ï¼Œè¿™ä¸ªè£…é¥°å™¨å¯ä»¥å‘½å Providerï¼Œä»£è¡¨å®ƒå°†ä¼šä½œä¸ºæä¾›è€…ç»™å…¶ä»–ç±»è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// provider.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CLASS_KEY = <span class="string">&quot;ioc:tagged_class&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Provider</span>(<span class="params">identifier: <span class="built_in">string</span>, args?: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">Reflect</span>.defineMetadata(</span><br><span class="line">      CLASS_KEY,</span><br><span class="line">      &#123;</span><br><span class="line">        id: identifier,</span><br><span class="line">        args: args || [],</span><br><span class="line">      &#125;,</span><br><span class="line">      target</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> target;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä½¿ç”¨<code>Provider</code>å¯¹ç±» è¿›è¡Œæ ‡è®°, ä¸ºäº†ä¹‹åå°†å…¶è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// modB.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&quot;provider&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Provider</span>(<span class="string">&quot;b&quot;</span>, [<span class="number">10</span>])</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">  p: <span class="built_in">number</span>;</span><br><span class="line">  <span class="function"><span class="title">constructor</span>(<span class="params">p: <span class="built_in">number</span></span>)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.p = p;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­çš„æ€è·¯åˆ™æ˜¯åœ¨å¯åŠ¨çš„æ—¶å€™å¯¹æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰«æï¼Œè·å–æ¯ä¸ªæ–‡ä»¶å¯¼å‡ºçš„ç±»ï¼Œç„¶åæ ¹æ®å…ƒæ•°æ®è¿›è¡Œç»‘å®šã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å‡è®¾é¡¹ç›®ç›®å½•åªæœ‰ä¸€çº§æ–‡ä»¶ï¼Œå®ç°å¦‚ä¸‹:</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// load.ts</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">&quot;fs&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CLASS_KEY &#125; <span class="keyword">from</span> <span class="string">&quot;./provider&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span>(<span class="params">container</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// container ä¸ºå…¨å±€çš„ IoC å®¹å™¨</span></span><br><span class="line">  <span class="keyword">const</span> list = fs.readdirSync(<span class="string">&quot;./&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> file <span class="keyword">of</span> list) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="regexp">/\.ts$/</span>.test(file)) &#123;</span><br><span class="line">      <span class="comment">// æ‰«æ ts æ–‡ä»¶</span></span><br><span class="line">      <span class="keyword">const</span> <span class="built_in">exports</span> = <span class="built_in">require</span>(<span class="string">`./<span class="subst">$&#123;file&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">const</span> m <span class="keyword">in</span> <span class="built_in">exports</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="built_in">module</span> = <span class="built_in">exports</span>[m];</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="built_in">module</span> === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="keyword">const</span> metadata = <span class="built_in">Reflect</span>.getMetadata(CLASS_KEY, <span class="built_in">module</span>);</span><br><span class="line">          <span class="comment">// æ³¨å†Œå®ä¾‹</span></span><br><span class="line">          <span class="keyword">if</span> (metadata) &#123;</span><br><span class="line">            container.bind(metadata.id, <span class="built_in">module</span>, metadata.args);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åªéœ€åœ¨é¡¹ç›®å¯åŠ¨æ—¶è¿è¡Œ<code>load</code>,å°±å¯å°†å£°æ˜æ—¶è¢«<code>Provider</code>è£…é¥°çš„ç±»,è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container &#125; <span class="keyword">from</span> <span class="string">&quot;./container&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; load &#125; <span class="keyword">from</span> <span class="string">&quot;./load&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– IOC å®¹å™¨ï¼Œæ‰«ææ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> container = <span class="keyword">new</span> Container();</span><br><span class="line">load(container);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(container.get(<span class="string">&quot;b&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="DI-Inject"><a href="#DI-Inject" class="headerlink" title="DI Inject"></a>DI Inject</h3><p>ä¸Šæ–‡æåŠ</p>
<blockquote>
<ul>
<li>ç¨‹åºå¯åŠ¨æ—¶,æ‰€æœ‰ç±»å‹ä¼šåœ¨å®¹å™¨ä¸­è‡ªåŠ¨æ³¨å†Œ</li>
<li>å®ä¾‹åŒ–æ—¶ç±»å‹æ‰€éœ€çš„å¯¹è±¡çš„è‡ªåŠ¨æ³¨å…¥, æ— éœ€åœ¨æ„é€ å‡½æ•°ä¸­æŒ‡å®š</li>
</ul>
</blockquote>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜è§£å†³å,å†æ¥çœ‹ç¬¬äºŒä¸ªé—®é¢˜,æˆ‘ä»¬å·²ç»å°†æ‰€æœ‰éœ€è¦æ³¨å†Œçš„ç±»éƒ½æ”¾å…¥äº† IoC å®¹å™¨ï¼Œé‚£ä¹ˆï¼Œå½“æˆ‘ä»¬éœ€è¦ç”¨åˆ°æŸä¸ªç±»æ—¶ï¼Œåœ¨è·å–è¿™ä¸ªç±»çš„å®ä¾‹æ—¶å¯ä»¥é€’å½’éå†ç±»ä¸Šçš„å±æ€§ï¼Œå¹¶ä» IoC å®¹å™¨ä¸­å–å‡ºç›¸åº”çš„å¯¹è±¡å¹¶è¿›è¡Œèµ‹å€¼ï¼Œå³å¯å®Œæˆä¾èµ–çš„æ³¨å…¥</p>
<p>é‚£ä¹ˆï¼Œåˆæ˜¯ç±»ä¼¼çš„é—®é¢˜ï¼Œå¦‚ä½•åŒºåˆ†å“ªäº›å±æ€§éœ€è¦æ³¨å…¥ï¼ŸåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…ƒæ•°æ®æ¥è§£å†³ã€‚åªè¦å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨ï¼Œä»¥æ­¤æ¥æ ‡è®°å“ªäº›å±æ€§éœ€è¦æ³¨å…¥å³å¯ï¼Œè¿™ä¸ªè£…é¥°å™¨å‘½åä¸º <code>Inject</code>ï¼Œä»£è¡¨è¯¥å±æ€§éœ€è¦æ³¨å…¥ä¾èµ–ã€‚</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Inject.ts</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;reflect-metadata&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> PROPS_KEY = <span class="string">&quot;ioc:inject_props&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">Inject</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">target: <span class="built_in">any</span>, propertyKey: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> annotationTarget = target.constructor;</span><br><span class="line">    <span class="keyword">let</span> props = &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Reflect</span>.hasOwnMetadata(PROPS_KEY, annotationTarget)) &#123;</span><br><span class="line">      props = <span class="built_in">Reflect</span>.getMetadata(PROPS_KEY, annotationTarget);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    props[targetKey] = &#123;</span><br><span class="line">      value: targetKey,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Reflect</span>.defineMetadata(PROPS_KEY, props, annotationTarget);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬è™½ç„¶æ˜¯å¯¹å±æ€§è¿›è¡Œä¿®é¥°ï¼Œä½†å®é™…å…ƒæ•°æ®æ˜¯è¦å®šä¹‰åœ¨ç±»ä¸Šï¼Œä»¥ç»´æŠ¤è¯¥ç±»éœ€è¦æ³¨å…¥çš„å±æ€§åˆ—è¡¨ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡»å– <code>target.constructor</code> ä½œä¸ºè¦æ“ä½œçš„ <code>target</code>ã€‚å¦å¤–ï¼Œä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œè¿™é‡Œç›´æ¥ç”¨äº†å±æ€§åï¼ˆ<code>targetKey</code>ï¼‰ä½œä¸ºä» IoC å®¹å™¨ä¸­å®ä¾‹å¯¹åº”çš„ keyã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ IoC å®¹å™¨çš„ get æ–¹æ³•ï¼Œé€’å½’æ³¨å…¥æ‰€æœ‰å±æ€§ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// container.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; PROPS_KEY &#125; <span class="keyword">from</span> <span class="string">&#x27;./inject&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="class"><span class="keyword">class</span> <span class="title">Container</span> </span>&#123;</span><br><span class="line">    bindMap = <span class="keyword">new</span> <span class="built_in">Map</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">bind</span>(<span class="params">identifier: <span class="built_in">string</span>, clazz: <span class="built_in">any</span>, constructorArgs?: <span class="built_in">Array</span>&lt;<span class="built_in">any</span>&gt;</span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bindMap.set(identifier, &#123;</span><br><span class="line">            clazz,</span><br><span class="line">            <span class="title">constructorArgs</span>: <span class="title">constructorArgs</span> || []</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get&lt;T&gt;(identifier: <span class="built_in">string</span>): T &#123;</span><br><span class="line">        <span class="keyword">const</span> target = <span class="built_in">this</span>.bindMap.get(identifier);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> &#123; clazz, <span class="title">constructorArgs</span> &#125; = <span class="title">target</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> props = <span class="built_in">Reflect</span>.getMetadata(PROPS_KEY, clazz);</span><br><span class="line">        <span class="keyword">const</span> inst = <span class="built_in">Reflect</span>.construct(clazz, <span class="title">constructorArgs</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> prop <span class="keyword">in</span> props) &#123;</span><br><span class="line">            <span class="keyword">const</span> identifier = props[prop].value;</span><br><span class="line">            <span class="comment">// é€’å½’è·å–æ³¨å…¥çš„å¯¹è±¡</span></span><br><span class="line">            inst[ prop ] = <span class="built_in">this</span>.get(identifier);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> inst;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„æ—¶å€™ï¼Œç”¨ <code>Inject</code> å¯¹å±æ€§(ä¾èµ–çš„å®ä¾‹)è¿›è¡Œè£…é¥°å³å¯ï¼š</p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Provider &#125; <span class="keyword">from</span> <span class="string">&#x27;provider&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Provider</span>(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  a: A;</span><br><span class="line">  <span class="meta">@Inject</span>()</span><br><span class="line">  b: B;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆä»£ç åˆ™æœ‰: </p>
<figure class="highlight typescript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// main.ts</span></span><br><span class="line"><span class="keyword">import</span> &#123; Container &#125; <span class="keyword">from</span> <span class="string">&quot;./container&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; load &#125; <span class="keyword">from</span> <span class="string">&quot;./load&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ– IOC å®¹å™¨ï¼Œæ‰«ææ–‡ä»¶</span></span><br><span class="line"><span class="keyword">const</span> container = <span class="keyword">new</span> Container();</span><br><span class="line">load(container);</span><br><span class="line"></span><br><span class="line"><span class="comment">// get æ—¶æ‰«æå…ƒæ•°æ®è·å–ä¾èµ–çš„å±æ€§, å°†é€’å½’æ³¨å…¥å®ä¾‹å¯¹è±¡</span></span><br><span class="line"><span class="built_in">console</span>.log(container.get(<span class="string">&quot;c&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>åˆ™å¯ç†è§£ä¸º <code>Provider</code>è£…é¥°çš„ç±»å°†è‡ªåŠ¨æ³¨å†Œåˆ°å®¹å™¨ä¸­, <code>Inject</code>è£…é¥°çš„å±æ€§ åˆ™ä¸ºä¾èµ–çš„ç±»çš„å®ä¾‹, å½“ä»å®¹å™¨getä¸€ä¸ªç±»å‹çš„å®ä¾‹æ—¶,ä¼šå°†è¯¥ç±»å‹æ‰€ä¾èµ–å®ä¾‹è‡ªåŠ¨æ³¨å…¥åˆ°äº§å‡ºçš„å®ä¾‹ä¸­</p>
<p>æ–‡ç« æ¥è‡ª:</p>
<p><a href="https://www.typescriptlang.org/docs/handbook/decorators.html#introduction">ts decorators</a></p>
<p><a href="https://juejin.cn/post/6859314697204662279">èµ°è¿‘ MidwayJSï¼šåˆè¯† TS è£…é¥°å™¨ä¸ IoC æœºåˆ¶</a></p>
<p><a href="https://juejin.cn/post/6898882861277904910">å¦‚ä½•åŸºäº TypeScript å®ç°æ§åˆ¶åè½¬</a></p>
<p><a href="https://juejin.cn/post/6972421467552088072">Reflect Metadata(å…ƒæ•°æ®)å­¦ä¹ ç¬”è®°</a></p>
<p><a href="https://github.com/rbuckton/reflect-metadata#metadata-reflection-api">metadata-reflection-api</a></p>
<p><a href="https://juejin.cn/post/6844903970289238030">æœ‰è¶£çš„è£…é¥°å™¨ï¼šä½¿ç”¨ Reflect Metadata å®è·µä¾èµ–æ³¨å…¥</a></p>
]]></content>
      <categories>
        <category>æŠ€æœ¯ç›¸å…³</category>
      </categories>
      <tags>
        <tag>å­¦ä¹ </tag>
      </tags>
  </entry>
</search>
